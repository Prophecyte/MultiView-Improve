/* ============================================
   MULTIVIEW CRAFT ROOM - v4 with Map Mode
   ============================================ */

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --gold: #d4a824;
  --gold-light: #f0d050;
  --gold-dark: #a07810;
  --gold-glow: rgba(212, 168, 36, 0.4);
  --gold-subtle: rgba(212, 168, 36, 0.1);

  --ember: #ff6b35;
  --ember-dark: #c44536;
  --ember-glow: rgba(255, 107, 53, 0.3);

  --cyan: #4ecdc4;
  --purple: #8b5cf6;
  --rose: #f43f5e;
  --green: #22c55e;
  --teal: #14b8a6;

  --hp-red: #ef4444;
  --mp-blue: #3b82f6;
  --stress-orange: #f97316;

  --online: #4ade80;
  --online-glow: rgba(74, 222, 128, 0.4);

  --bg-darkest: #060606;
  --bg-dark: #0a0a0a;
  --bg-medium: #111111;
  --bg-light: #181818;
  --bg-lighter: #222222;
  --bg-hover: #2a2a2a;

  --text-primary: #f5ede0;
  --text-secondary: #a89880;
  --text-muted: #605545;

  --border-color: #252015;
  --border-light: #352a1a;

  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.5);
  --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.6);

  --radius-sm: 4px;
  --radius-md: 6px;
  --radius-lg: 10px;

  --transition-fast: 0.15s ease;
  --transition-normal: 0.25s ease;
}

/* Theme: Gold (default) */
[data-theme="gold"] {
  --gold: #d4a824;
  --gold-light: #f0d050;
  --gold-dark: #a07810;
  --gold-glow: rgba(212, 168, 36, 0.4);
  --gold-subtle: rgba(212, 168, 36, 0.1);
}

/* Theme: Ember Red */
[data-theme="ember"] {
  --gold: #ef4444;
  --gold-light: #f87171;
  --gold-dark: #b91c1c;
  --gold-glow: rgba(239, 68, 68, 0.4);
  --gold-subtle: rgba(239, 68, 68, 0.1);
}

/* Theme: Forest Green */
[data-theme="forest"] {
  --gold: #22c55e;
  --gold-light: #4ade80;
  --gold-dark: #16a34a;
  --gold-glow: rgba(34, 197, 94, 0.4);
  --gold-subtle: rgba(34, 197, 94, 0.1);
}

/* Theme: Ocean Blue */
[data-theme="ocean"] {
  --gold: #3b82f6;
  --gold-light: #60a5fa;
  --gold-dark: #2563eb;
  --gold-glow: rgba(59, 130, 246, 0.4);
  --gold-subtle: rgba(59, 130, 246, 0.1);
}

/* Theme: Royal Purple */
[data-theme="purple"] {
  --gold: #a855f7;
  --gold-light: #c084fc;
  --gold-dark: #9333ea;
  --gold-glow: rgba(168, 85, 247, 0.4);
  --gold-subtle: rgba(168, 85, 247, 0.1);
}

/* Theme: Sunset Orange */
[data-theme="sunset"] {
  --gold: #f97316;
  --gold-light: #fb923c;
  --gold-dark: #ea580c;
  --gold-glow: rgba(249, 115, 22, 0.4);
  --gold-subtle: rgba(249, 115, 22, 0.1);
}

/* Theme: Rose Pink */
[data-theme="rose"] {
  --gold: #ec4899;
  --gold-light: #f472b6;
  --gold-dark: #db2777;
  --gold-glow: rgba(236, 72, 153, 0.4);
  --gold-subtle: rgba(236, 72, 153, 0.1);
}

/* Theme: Cyan */
[data-theme="cyan"] {
  --gold: #06b6d4;
  --gold-light: #22d3ee;
  --gold-dark: #0891b2;
  --gold-glow: rgba(6, 182, 212, 0.4);
  --gold-subtle: rgba(6, 182, 212, 0.1);
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI',
    sans-serif;
  background: var(--bg-darkest);
  color: var(--text-primary);
  height: 100vh;
  overflow: hidden;
}

/* ============================================
       Layout
       ============================================ */
.dashboard {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.dashboard-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  height: 56px;
  background: var(--bg-dark);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.header-left,
.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ============================================
       Buttons
       ============================================ */
.icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-md);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition-fast);
}

.icon-btn:hover {
  background: var(--bg-lighter);
  color: var(--text-primary);
  border-color: var(--border-light);
}

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: var(--radius-md);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition-fast);
}

.btn.primary {
  background: var(--gold);
  color: var(--bg-darkest);
}

.btn.primary:hover {
  background: var(--gold-light);
}

.btn.primary:disabled {
  background: var(--bg-lighter);
  color: var(--text-muted);
  cursor: not-allowed;
}

.btn.secondary {
  background: var(--bg-lighter);
  color: var(--text-primary);
  border: 1px solid var(--border-light);
}

.btn.secondary:hover {
  background: var(--bg-hover);
}

.btn.danger {
  background: var(--rose);
  color: white;
}

.btn.danger:hover {
  background: #dc2626;
}

.btn.sm {
  padding: 4px 10px;
  font-size: 12px;
}
.btn.full-width {
  width: 100%;
}

/* ============================================
       Header Elements
       ============================================ */
.logo-small {
  display: flex;
  align-items: center;
  gap: 8px;
}

.dragon-icon {
  font-size: 20px;
}

.brand-text {
  font-family: 'Cinzel', serif;
  font-size: 16px;
  font-weight: 600;
  color: var(--gold);
}

.separator {
  color: var(--text-muted);
  font-size: 18px;
}

.room-title-container {
  display: flex;
  align-items: center;
  gap: 10px;
}

.room-title-input {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-primary);
  font-size: 15px;
  font-weight: 500;
  padding: 6px 10px;
  border-radius: var(--radius-sm);
  width: 200px;
  transition: var(--transition-fast);
}

.room-title-input:hover {
  border-color: var(--border-light);
}
.room-title-input:focus {
  outline: none;
  border-color: var(--gold-dark);
  background: var(--bg-medium);
}

.room-type-badge {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1px;
  padding: 3px 8px;
  background: var(--ember-glow);
  color: var(--ember);
  border-radius: var(--radius-sm);
}

/* View Toggle */
.view-toggle {
  display: flex;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 3px;
}

.view-toggle-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition-fast);
}

.view-toggle-btn:hover {
  color: var(--text-primary);
}

.view-toggle-btn.active {
  background: var(--gold);
  color: var(--bg-darkest);
}

.view-toggle-btn.active svg {
  stroke: var(--bg-darkest);
}

/* Dice Roller Button */
.dice-roller-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 13px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.dice-roller-btn:hover {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
}

.dice-icon {
  font-size: 16px;
}

/* Collaborators */
.collaborators {
  display: flex;
  align-items: center;
  gap: 6px;
}

.avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 600;
  color: white;
  border: 2px solid var(--bg-dark);
  margin-left: -8px;
}

.avatar:first-child {
  margin-left: 0;
}

.online-count {
  font-size: 12px;
  color: var(--text-secondary);
  margin-left: 4px;
}

/* ============================================
       Popup Modal (Custom)
       ============================================ */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.15s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.popup-overlay.hidden {
  display: none;
}

.popup-modal {
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  min-width: 320px;
  max-width: 90vw;
  animation: slideUp 0.2s ease;
}

.popup-modal.sm {
  min-width: 280px;
  max-width: 400px;
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.popup-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
}

.popup-header h3 {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
}

.popup-body {
  padding: 20px;
}

.popup-label {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 6px;
  margin-top: 12px;
}

.popup-label:first-child {
  margin-top: 0;
}

.popup-input,
.popup-select {
  width: 100%;
  padding: 10px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 14px;
}

.popup-input:focus,
.popup-select:focus {
  outline: none;
  border-color: var(--gold-dark);
}

.popup-textarea {
  width: 100%;
  min-height: 80px;
  padding: 10px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 14px;
  resize: vertical;
  font-family: inherit;
  line-height: 1.5;
}

.popup-textarea:focus {
  outline: none;
  border-color: var(--gold-dark);
}

.popup-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 16px 20px;
  border-top: 1px solid var(--border-color);
}

/* Pin Color Options */
.pin-color-options {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.pin-color-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 3px solid transparent;
  cursor: pointer;
  transition: var(--transition-fast);
}

.pin-color-btn:hover {
  transform: scale(1.1);
}

.pin-color-btn.active {
  border-color: var(--text-primary);
  box-shadow: 0 0 0 2px var(--bg-dark);
}

/* Pin Shape Options */
.pin-shape-options {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.pin-shape-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-medium);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition-fast);
  color: var(--text-secondary);
}

.pin-shape-btn:hover {
  border-color: var(--gold-dark);
  color: var(--gold);
}

.pin-shape-btn.active {
  border-color: var(--gold);
  background: var(--gold-subtle);
  color: var(--gold);
}

.pin-shape-btn svg {
  width: 20px;
  height: 20px;
}

/* Associations List */
.associations-list {
  margin-top: 8px;
  max-height: 150px;
  overflow-y: auto;
}

/* --- Associations rows (match connection-item layout) --- */
.association-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  margin-bottom: 4px;
  cursor: pointer;
}

.association-row:hover {
  background: var(--bg-hover);
}

.association-swatch {
  width: 12px;
  height: 12px;
  flex: 0 0 12px;
  border-radius: 3px;
  display: inline-block;
}

.association-swatch.type-pin {
  border-radius: 999px;
}

.association-swatch.type-map {
  border-radius: 3px;
}

.association-title {
  flex: 1 1 auto;
  min-width: 0;
  font-size: 12px;
  color: var(--gold);
  text-decoration: underline;
  text-decoration-style: dashed;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.association-meta {
  font-size: 10px;
  color: var(--text-muted);
  text-transform: uppercase;
  white-space: nowrap;
}

.association-remove {
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
}

.association-remove:hover {
  background: var(--bg-lighter);
  color: var(--rose);
}

.associations-list .no-associations {
  font-size: 12px;
  color: var(--text-muted);
  font-style: italic;
  padding: 8px 0;
}

.association-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  margin-bottom: 4px;
  cursor: pointer;
}

.association-item:hover {
  background: var(--bg-hover);
}

.association-icon {
  width: 12px !important;
  height: 12px !important;
  min-width: 12px !important;
  min-height: 12px !important;
  max-width: 12px !important;
  max-height: 12px !important;
  border-radius: 50%;
  flex: 0 0 12px;
  flex-shrink: 0;
  flex-grow: 0;
  display: inline-block !important;
  align-self: center;
}

.association-icon.card {
  border-radius: 3px;
}

.association-icon.chapter {
  border-radius: 2px;
}

.association-icon.pin {
  border-radius: 50%;
}

.association-name {
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 12px;
  color: var(--gold);
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dashed;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.association-name:hover {
  color: var(--gold-light);
}

.association-type {
  font-size: 10px;
  color: var(--text-muted);
  text-transform: uppercase;
}

.remove-association-btn {
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  transition: var(--transition-fast);
}

.remove-association-btn:hover {
  background: var(--bg-lighter);
  color: var(--rose);
}

/* Pin Detail Associations */
.pin-detail-associations {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.pin-detail-associations .no-associations {
  font-size: 12px;
  color: var(--text-muted);
  font-style: italic;
}

/* Pin List Shape Indicator */
.pin-shape-indicator {
  width: 12px;
  height: 12px;
  flex-shrink: 0;
  --pin-color: #ef4444;
}

.pin-shape-indicator.circle {
  border-radius: 50%;
  background: var(--pin-color);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.pin-shape-indicator.diamond {
  width: 10px;
  height: 10px;
  background: var(--pin-color);
  transform: rotate(45deg);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.pin-shape-indicator.marker,
.pin-shape-indicator.pin {
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 10px solid var(--pin-color);
}

.pin-shape-indicator.square {
  border-radius: 2px;
  background: var(--pin-color);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.pin-shape-indicator.star {
  background: var(--pin-color);
  clip-path: polygon(
    50% 0%,
    61% 35%,
    98% 35%,
    68% 57%,
    79% 91%,
    50% 70%,
    21% 91%,
    32% 57%,
    2% 35%,
    39% 35%
  );
}

.pin-shape-indicator.triangle,
.pin-shape-indicator.flag {
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 10px solid var(--pin-color);
}

/* Zoom Controls Divider */
.zoom-divider {
  width: 1px;
  height: 20px;
  background: var(--border-color);
  margin: 0 4px;
}

/* Image Upload Modal */
.upload-tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 16px;
}

.upload-tab {
  flex: 1;
  padding: 8px 16px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 13px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.upload-tab:hover {
  color: var(--text-primary);
}

.upload-tab.active {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
  color: var(--gold);
}

.upload-tab-content {
  display: none;
}
.upload-tab-content.active {
  display: block;
}

.file-drop-zone {
  border: 2px dashed var(--border-light);
  border-radius: var(--radius-md);
  padding: 40px 20px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition-fast);
}

.file-drop-zone:hover {
  border-color: var(--gold-dark);
  background: var(--gold-subtle);
}

.file-drop-zone span {
  font-size: 32px;
  display: block;
  margin-bottom: 8px;
}
.file-drop-zone p {
  color: var(--text-secondary);
  font-size: 13px;
}

.file-preview {
  text-align: center;
}

.file-preview img {
  max-width: 100%;
  max-height: 200px;
  border-radius: var(--radius-md);
  margin-bottom: 12px;
}

/* Table Modal */
.table-size-inputs {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.size-input-group {
  flex: 1;
}

.size-input-group label {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 6px;
}

.size-input-group input {
  width: 100%;
  padding: 8px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 14px;
}

.table-preview-grid {
  display: grid;
  gap: 2px;
  background: var(--border-color);
  border-radius: var(--radius-sm);
  padding: 2px;
}

.table-preview-cell {
  width: 24px;
  height: 24px;
  background: var(--bg-lighter);
  border-radius: 2px;
}

/* Dice Modal */
.dice-modal {
  padding-bottom: 16px;
}

.dice-options {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  padding: 16px 20px;
  justify-content: center;
}

.dice-btn {
  width: 64px;
  height: 72px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  background: var(--bg-lighter);
  border: 2px solid var(--border-light);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-fast);
}

.dice-btn:hover {
  background: var(--gold-subtle);
  border-color: var(--gold);
  color: var(--gold);
  transform: translateY(-2px);
}

.dice-btn:active {
  transform: translateY(0);
}

.dice-svg {
  width: 32px;
  height: 32px;
}

.dice-btn:hover .dice-svg {
  color: var(--gold);
}

.dice-custom {
  display: flex;
  gap: 8px;
  padding: 0 20px 16px;
}

.dice-custom input {
  flex: 1;
  padding: 10px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 14px;
}

.dice-custom input:focus {
  outline: none;
  border-color: var(--gold-dark);
}

.dice-result {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 20px;
  margin: 0 20px 16px;
  background: var(--bg-medium);
  border-radius: var(--radius-md);
}

.result-label {
  font-size: 14px;
  color: var(--text-secondary);
}

.result-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--gold);
  font-family: 'Cinzel', serif;
}

.dice-actions {
  padding: 0 20px 16px;
}
.dice-actions .btn {
  width: 100%;
}

.dice-history {
  max-height: 160px;
  overflow-y: auto;
  padding: 0 20px;
}

.dice-history-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  font-size: 12px;
  color: var(--text-secondary);
  border-top: 1px solid var(--border-color);
}
.dice-history-roll {
  display: flex;
  gap: 10px;
  flex: 1;
}
.dice-history-val {
  font-weight: 600;
  color: var(--text-primary);
}
.dice-history-insert {
  padding: 2px 8px;
  font-size: 10px;
  background: none;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-muted);
  cursor: pointer;
  transition: var(--transition-fast);
  opacity: 0;
}
.dice-history-item:hover .dice-history-insert {
  opacity: 1;
}
.dice-history-insert:hover {
  color: var(--gold);
  border-color: var(--gold);
  background: rgba(212,168,36,0.08);
}

/* ============================================
       Context Menu
       ============================================ */
.context-menu {
  position: fixed;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  min-width: 180px;
  z-index: 1000;
  padding: 4px 0;
}

.context-menu.hidden {
  display: none;
}

.context-menu-item {
  padding: 8px 16px;
  font-size: 13px;
  color: var(--text-primary);
  cursor: pointer;
  transition: var(--transition-fast);
}

.context-menu-item:hover {
  background: var(--bg-hover);
}

.context-menu-item.danger {
  color: var(--rose);
}
.context-menu-item.danger:hover {
  background: rgba(244, 63, 94, 0.1);
}

.context-menu-divider {
  height: 1px;
  background: var(--border-color);
  margin: 4px 0;
}

.context-menu-submenu {
  position: relative;
}

.context-menu-item.has-submenu {
  display: flex;
  justify-content: space-between;
}

.context-submenu {
  position: absolute;
  left: 100%;
  top: 0;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  min-width: 140px;
  padding: 4px 0;
  display: none;
}

.context-menu-submenu:hover .context-submenu {
  display: block;
}

/* ============================================
       Main Content
       ============================================ */
.main-content {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ============================================
       Sidebar
       ============================================ */
.sidebar {
  width: 240px;
  background: var(--bg-dark);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  transition: width var(--transition-normal);
  overflow-y: auto;
  overflow-x: hidden;
}

.sidebar.collapsed {
  width: 0;
  border-right: none;
}

.sidebar-section {
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
}

.sidebar-section:last-child {
  border-bottom: none;
}
.sidebar-section.hidden {
  display: none;
}

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.section-header.collapsible {
  cursor: pointer;
}
.section-header.collapsible:hover {
  color: var(--gold);
}

.section-header span:first-child {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
}

.collapse-icon {
  font-size: 10px;
  color: var(--text-muted);
  transition: transform var(--transition-fast);
}

.section-header.collapsed .collapse-icon {
  transform: rotate(-90deg);
}

.add-btn {
  width: 22px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.add-btn:hover {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
  color: var(--gold);
}

/* Boards, Maps & Chapters Lists */
.boards-list,
.maps-list,
.chapters-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.board-item,
.map-item,
.chapter-item {
  display: flex;
  align-items: center;
  padding: 8px 10px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition-fast);
  gap: 8px;
}

.board-item:hover,
.map-item:hover,
.chapter-item:hover {
  background: var(--bg-hover);
}

.board-item.active,
.map-item.active,
.chapter-item.active {
  background: var(--gold-subtle);
}

.board-item.active .board-name,
.map-item.active .map-name,
.chapter-item.active .chapter-title {
  color: var(--gold);
}

.drag-handle {
  color: var(--text-muted);
  cursor: grab;
  font-size: 12px;
  opacity: 0;
  transition: var(--transition-fast);
}

.board-item:hover .drag-handle,
.map-item:hover .drag-handle,
.chapter-item:hover .drag-handle {
  opacity: 1;
}

.board-name,
.map-name,
.chapter-title {
  flex: 1;
  font-size: 13px;
  color: var(--text-secondary);
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  min-width: 0;
}

.board-name:focus,
.map-name:focus,
.chapter-title:focus {
  outline: none;
  color: var(--text-primary);
}

.chapter-info {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
}

.chapter-label-input {
  font-size: 10px;
  color: var(--text-muted);
  background: transparent;
  border: none;
  padding: 0;
  width: 100%;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.chapter-label-input:focus {
  outline: none;
  color: var(--text-secondary);
}

.delete-item-btn {
  opacity: 0;
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 2px 6px;
  transition: var(--transition-fast);
}

.board-item:hover .delete-item-btn,
.map-item:hover .delete-item-btn,
.chapter-item:hover .delete-item-btn {
  opacity: 1;
}

.delete-item-btn:hover {
  color: var(--rose);
}

.chapter-words {
  font-size: 10px;
  color: var(--text-muted);
}

/* Pins List */
.pins-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.empty-pins-message {
  font-size: 12px;
  color: var(--text-muted);
  text-align: center;
  padding: 16px 0;
  font-style: italic;
}

.pin-list-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition-fast);
}

.pin-list-item:hover {
  background: var(--bg-hover);
}
.pin-list-item.active {
  background: var(--gold-subtle);
}

.pin-list-color {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.pin-list-name {
  flex: 1;
  font-size: 13px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pin-list-item.active .pin-list-name {
  color: var(--gold);
}

/* Card Templates */
.card-templates {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 500px;
  overflow-y: auto;
}

.card-templates.collapsed {
  display: none;
}

.template-category {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  padding: 12px 10px 6px;
  border-top: 1px solid var(--border-color);
  margin-top: 4px;
}

.template-category:first-child {
  border-top: none;
  margin-top: 0;
  padding-top: 0;
}

.template-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 13px;
  cursor: pointer;
  transition: var(--transition-fast);
  text-align: left;
}

.template-btn:hover {
  background: var(--bg-hover);
  border-color: var(--border-light);
  color: var(--text-primary);
}

.template-color {
  width: 12px;
  height: 12px;
  border-radius: 3px;
  flex-shrink: 0;
}

/* ============================================
       Canvas (Board View)
       ============================================ */
.canvas-container {
  flex: 1;
  position: relative;
  background: var(--bg-medium);
  background-image: radial-gradient(
    circle at 1px 1px,
    var(--border-color) 1px,
    transparent 0
  );
  background-size: 24px 24px;
  overflow: hidden;
}

.canvas-container.panning {
  cursor: grab;
}
.canvas-container.panning:active {
  cursor: grabbing;
}

.connections-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 5000px;
  height: 5000px;
  pointer-events: none;
  z-index: 1;
}

/* Only the wide invisible hit-path should capture events; the visible line remains non-interactive. */
.connection-hit {
  pointer-events: stroke;
}
.connection-line {
  pointer-events: none;
  stroke-linecap: round;
}

/* Make selected connection a little more obvious (without overriding stroke/width). */
.selected-connection {
  filter: drop-shadow(0 0 6px rgba(244, 63, 94, 0.55));
}

.canvas {
  position: absolute;
  width: 5000px;
  height: 5000px;
  transform-origin: 0 0;
}

.canvas-empty-state {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: var(--text-muted);
  pointer-events: none;
  z-index: 1;
}

.canvas-empty-state p {
  font-size: 16px;
  margin-bottom: 8px;
}
.canvas-empty-state .subtext {
  font-size: 13px;
  opacity: 0.7;
}
.canvas-empty-state.hidden {
  display: none;
}

/* ============================================
       Map View
       ============================================ */
.map-container {
  flex: 1;
  position: relative;
  background: var(--bg-medium);
  overflow: hidden;
}

.map-container.hidden {
  display: none;
}

.map-container.panning {
  cursor: grab;
}
.map-container.panning:active {
  cursor: grabbing;
}

.map-canvas {
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}
.map-container[data-tool="map-pin"] .map-canvas { cursor: crosshair; }
.map-container[data-tool="map-destination"] .map-canvas { cursor: crosshair; }
.map-container[data-tool="map-measure"] .map-canvas { cursor: crosshair; }

.map-image-wrapper {
  position: absolute;
  transform-origin: 0 0;
  transition: transform 0.05s ease-out;
}

.map-image {
  display: block;
  max-width: none;
  user-select: none;
  pointer-events: none;
}

.map-image.hidden {
  display: none;
}

.pins-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2;
}

.map-empty-state {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: var(--text-muted);
  pointer-events: auto;
  cursor: pointer;
  z-index: 1;
  padding: 40px 60px;
  border: 2px dashed rgba(168, 152, 128, 0.25);
  border-radius: var(--radius-lg);
  transition: border-color 0.2s ease, background 0.2s ease;
}

.map-empty-state:hover {
  border-color: var(--gold-dark);
  background: rgba(212, 168, 36, 0.05);
}

.map-upload-icon {
  font-size: 48px;
  margin-bottom: 12px;
  opacity: 0.6;
}

.map-empty-state p {
  font-size: 16px;
  margin-bottom: 8px;
  font-weight: 500;
}
.map-empty-state .subtext {
  font-size: 13px;
  opacity: 0.6;
}
.map-empty-state.hidden {
  display: none;
}

/* ============================================
       Flat Pin Design
       ============================================ */
.map-pin {
  position: absolute;
  transform: translate(-50%, -50%) scale(var(--pin-scale, 1));
  cursor: pointer;
  z-index: 10;
  pointer-events: auto;
  --pin-color: #ef4444;
  --pin-scale: 1;
  transition: transform 0.2s ease, filter 0.2s ease;
}
.map-pin:hover {
  z-index: 20;
  filter: brightness(1.2);
}

/* Base pin marker */
.pin-marker {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
}

/* Circle shape (default) */
.pin-marker.circle {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, color-mix(in srgb, var(--pin-color) 80%, white 20%), var(--pin-color) 60%, color-mix(in srgb, var(--pin-color) 80%, black 20%));
  border: 2.5px solid rgba(255, 255, 255, 0.9);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(0, 0, 0, 0.15);
}

/* Diamond shape */
.pin-marker.diamond {
  width: 28px;
  height: 28px;
  background: var(--pin-color);
  border: 3px solid rgba(255, 255, 255, 0.9);
  transform: rotate(45deg);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

/* Map pin/marker shape */
.pin-marker.pin-drop {
  width: 36px;
  height: 46px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
}

.pin-marker.pin-drop svg {
  width: 100%;
  height: 100%;
}

/* Square shape */
.pin-marker.square {
  width: 28px;
  height: 28px;
  background: var(--pin-color);
  border: 3px solid rgba(255, 255, 255, 0.9);
  border-radius: 3px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

/* Star shape */
.pin-marker.star {
  width: 38px;
  height: 38px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
}

.pin-marker.star svg {
  width: 100%;
  height: 100%;
}

/* Triangle shape */
.pin-marker.triangle {
  width: 0;
  height: 0;
  border-left: 17px solid transparent;
  border-right: 17px solid transparent;
  border-bottom: 28px solid var(--pin-color);
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4)) drop-shadow(0 0 0 1px rgba(255,255,255,0.6));
  background: none;
}

/* Triangle border via drop-shadow outline */
.pin-marker.triangle::after {
  content: '';
  position: absolute;
  top: -3px;
  left: -17px;
  width: 0;
  height: 0;
  border-left: 17px solid transparent;
  border-right: 17px solid transparent;
  border-bottom: 28px solid rgba(255, 255, 255, 0.85);
  z-index: -1;
}

/* Pin icon inside markers */
.pin-icon-inner {
  font-size: 15px;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.6);
  position: relative;
  z-index: 2;
  line-height: 1;
}

.pin-marker.circle .pin-icon-inner {
  font-size: 16px;
}

.pin-marker.diamond .pin-icon-inner {
  font-size: 13px;
  transform: rotate(-45deg);
}

.pin-marker.square .pin-icon-inner {
  font-size: 14px;
}

/* Icon overlay for SVG-based shapes (pin-drop, star) */
.pin-icon-overlay {
  position: absolute;
  top: 28%;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pin-marker.star .pin-icon-overlay {
  top: 32%;
}

.pin-icon-overlay .pin-icon-inner {
  font-size: 11px;
}

/* Icon below triangle */
.pin-icon-below {
  position: absolute;
  top: 4px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
}

.pin-icon-below .pin-icon-inner {
  font-size: 9px;
}

/* Pin icon selector in editor modal */
.pin-icon-options {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 8px;
  max-width: 340px;
}

.pin-icon-btn {
  width: 34px;
  height: 34px;
  border-radius: var(--radius-sm);
  border: 2px solid var(--border-color);
  background: var(--bg-card);
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 16px;
}

.pin-icon-btn:hover {
  border-color: var(--gold);
  color: var(--text-primary);
}

.pin-icon-btn.active {
  border-color: var(--gold);
  background: rgba(212, 168, 36, 0.15);
  color: var(--gold);
  box-shadow: 0 0 6px rgba(212, 168, 36, 0.3);
}

.pin-icon-btn .ra {
  font-size: 16px;
}

.map-pin:hover .pin-marker {
  transform: scale(1.3);
  filter: drop-shadow(0 3px 10px rgba(0, 0, 0, 0.6));
}

.map-pin:hover .pin-marker.diamond {
  transform: rotate(45deg) scale(1.3);
}

.map-pin.selected .pin-marker {
  box-shadow: 0 0 0 3px var(--gold-glow), 0 0 12px var(--gold-glow), 0 3px 10px rgba(0, 0, 0, 0.5);
  transform: scale(1.25);
}

.map-pin.selected .pin-marker.diamond {
  transform: rotate(45deg) scale(1.25);
}

.map-pin.selected .pin-marker.pin-drop,
.map-pin.selected .pin-marker.star {
  filter: drop-shadow(0 0 8px var(--gold))
    drop-shadow(0 3px 8px rgba(0, 0, 0, 0.5));
}

.map-pin.dragging {
  z-index: 100;
  cursor: grabbing;
}

.map-pin.dragging .pin-marker {
  transform: scale(1.35);
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.6));
}

.map-pin.dragging .pin-marker.diamond {
  transform: rotate(45deg) scale(1.35);
}

.pin-label {
  position: absolute;
  top: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(10, 8, 6, 0.92);
  color: #f5ede0;
  padding: 5px 12px;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.2s ease;
  pointer-events: none;
  max-width: 180px;
  overflow: hidden;
  text-overflow: ellipsis;
  border: 1px solid rgba(168, 152, 128, 0.15);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.map-pin:hover .pin-label,
.map-pin.selected .pin-label {
  opacity: 1;
}

/* ============================================
       Wiki Links
       ============================================ */
.wiki-link {
  color: var(--gold);
  text-decoration: underline;
  text-decoration-style: dashed;
  cursor: pointer;
  transition: color 0.15s ease;
}

.wiki-link:hover {
  color: var(--gold-light);
}

.wiki-link.broken {
  color: var(--rose);
  text-decoration-color: var(--rose);
}

/* ============================================
       Zoom Controls
       ============================================ */
.zoom-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  align-items: center;
  gap: 2px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 4px;
  z-index: 100;
}

.zoom-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 16px;
  cursor: pointer;
  border-radius: var(--radius-sm);
  transition: var(--transition-fast);
}

.zoom-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.zoom-level {
  padding: 0 8px;
  font-size: 12px;
  color: var(--text-muted);
  min-width: 50px;
  text-align: center;
}

/* Canvas Tools */
.canvas-tools {
  position: absolute;
  bottom: 20px;
  left: 20px;
  display: flex;
  gap: 4px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 4px;
  z-index: 100;
}

.tool-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: var(--radius-sm);
  transition: var(--transition-fast);
}

.tool-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.tool-btn.active {
  background: var(--gold);
  color: var(--bg-darkest);
}

.tool-divider {
  width: 1px;
  background: var(--border-color);
  margin: 4px 2px;
}

/* Connection Mode */
.connection-mode-indicator {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  background: var(--gold);
  color: var(--bg-darkest);
  border-radius: var(--radius-md);
  font-size: 13px;
  font-weight: 500;
  z-index: 100;
  box-shadow: var(--shadow-md);
}

.connection-mode-indicator.hidden {
  display: none;
}

/* Unified Photoshop-Style Board Toolbar */
.board-toolbar {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 16px;
  padding: 10px 16px;
  background: linear-gradient(180deg, #1a1816 0%, #131110 100%);
  border: 1px solid rgba(212, 168, 36, 0.15);
  border-bottom: 1px solid rgba(212, 168, 36, 0.25);
  border-radius: var(--radius-md);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5),
    inset 0 1px 0 rgba(245, 237, 224, 0.04);
  z-index: 10;
  transition: all 0.2s ease;
}

.board-toolbar[data-mode='card'],
.board-toolbar[data-mode='connection'],
.board-toolbar[data-mode='multi'] {
  border-color: rgba(212, 168, 36, 0.4);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.toolbar-section {
  display: flex;
  align-items: center;
  gap: 12px;
}

.toolbar-info {
  flex-shrink: 0;
  border-right: 1px solid rgba(168, 152, 128, 0.15);
  padding-right: 16px;
}

.toolbar-icon {
  font-size: 20px;
  color: var(--gold);
  filter: drop-shadow(0 0 8px rgba(212, 168, 36, 0.4));
}

.toolbar-title-group {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.toolbar-label {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--gold);
}

.toolbar-status {
  font-size: 12px;
  color: var(--text-secondary);
  white-space: nowrap;
}

.toolbar-controls {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  flex: 1;
}

.toolbar-control-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.toolbar-control-group label {
  font-size: 9px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
}

.toolbar-select,
.toolbar-control-group input[type='color'] {
  padding: 5px 10px;
  background: rgba(10, 8, 6, 0.6);
  border: 1px solid rgba(168, 152, 128, 0.2);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 11px;
  transition: all 0.15s ease;
}

.toolbar-select:hover,
.toolbar-control-group input[type='color']:hover {
  background: rgba(10, 8, 6, 0.8);
  border-color: rgba(212, 168, 36, 0.35);
}

.toolbar-select:focus,
.toolbar-control-group input[type='color']:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(212, 168, 36, 0.1);
}

.toolbar-control-group input[type='color'] {
  width: 36px;
  height: 26px;
  padding: 2px;
  cursor: pointer;
  border-radius: 4px;
}

#cardTopAccentPicker {
  width: 36px;
  height: 26px;
  padding: 2px;
  border: 1px solid rgba(168, 152, 128, 0.2);
  border-radius: 4px;
  background: rgba(10, 8, 6, 0.6);
  cursor: pointer;
}

.toolbar-clear-btn {
  margin-left: auto;
  padding: 6px 14px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.toolbar-divider-v {
  width: 1px;
  height: 28px;
  background: rgba(168, 152, 128, 0.2);
  margin: 0 4px;
  flex-shrink: 0;
}

.toolbar-select.sm {
  padding: 4px 6px;
  font-size: 10px;
  min-width: 60px;
  max-width: 90px;
}

.toolbar-toggle-group {
  display: flex;
  gap: 6px;
  align-items: center;
}

.toolbar-toggle {
  display: flex;
  align-items: center;
  gap: 3px;
  cursor: pointer;
  font-size: 10px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  user-select: none;
}

.toolbar-toggle input[type="checkbox"] {
  width: 14px;
  height: 14px;
  accent-color: var(--gold);
  cursor: pointer;
}

.toolbar-toggle span {
  opacity: 0.7;
}

.toolbar-toggle:hover span {
  opacity: 1;
}

/* ============================================
       Cards
       ============================================ */
.card {
  position: absolute;
  min-width: 120px;
  min-height: 60px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  cursor: move;
  transition: box-shadow var(--transition-fast),
    border-color var(--transition-fast);
  z-index: 10;
  user-select: none;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.card:hover {
  box-shadow: var(--shadow-lg);
  z-index: 20;
}

.card.selected {
  border-color: var(--gold);
  box-shadow: 0 0 0 2px var(--gold-glow), var(--shadow-lg);
  z-index: 30;
}

.card.connecting {
  border-color: var(--cyan);
  box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.3);
}

/* Card Designs */
.card.design-minimal {
  border: none;
  background: transparent;
  box-shadow: none;
}

.card.design-minimal.selected {
  outline: 2px dashed var(--gold);
}

.card.design-bordered {
  border-width: 2px;
}

.card.design-gradient {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
  border: 1px solid rgba(212, 168, 36, 0.3);
}

.card.design-gradient .card-type-indicator {
  background: linear-gradient(90deg, var(--gold-dark), var(--gold));
}

.card.design-glass {
  background: rgba(255, 255, 255, 0.04);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.card.design-parchment {
  background: linear-gradient(135deg, #2a2318 0%, #1e1a14 50%, #261f15 100%);
  border: 1px solid rgba(168, 140, 100, 0.3);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3), 0 4px 12px rgba(0, 0, 0, 0.4);
}

.card.design-parchment .card-type-indicator {
  background: linear-gradient(90deg, #8b6914, #c49b2a, #8b6914);
}

.card.design-dark-steel {
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
  border: 1px solid rgba(120, 120, 140, 0.4);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 4px 12px rgba(0, 0, 0, 0.5);
}

.card.design-dark-steel .card-type-indicator {
  background: linear-gradient(90deg, #4a4a5a, #6a6a7a, #4a4a5a);
}

.card.design-neon {
  background: rgba(10, 5, 20, 0.95);
  border: 1px solid rgba(130, 80, 255, 0.5);
  box-shadow: 0 0 15px rgba(130, 80, 255, 0.15), inset 0 0 30px rgba(130, 80, 255, 0.03), 0 4px 12px rgba(0, 0, 0, 0.5);
}
.card.design-neon .card-type-indicator {
  background: linear-gradient(90deg, #8250ff, #ff6bda, #8250ff);
  box-shadow: 0 0 10px rgba(130, 80, 255, 0.5);
}
.card.design-neon:hover {
  box-shadow: 0 0 20px rgba(130, 80, 255, 0.25), inset 0 0 30px rgba(130, 80, 255, 0.05), 0 6px 16px rgba(0, 0, 0, 0.6);
}
.card.design-neon.selected {
  border-color: rgba(130, 80, 255, 0.8);
  box-shadow: 0 0 25px rgba(130, 80, 255, 0.35), 0 0 4px 1px rgba(130, 80, 255, 0.3);
}

.card.design-worn {
  background: linear-gradient(145deg, #1f1b16 0%, #17140f 40%, #1a1610 60%, #1e1912 100%);
  border: 1px solid rgba(140, 115, 75, 0.25);
  box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(200, 170, 120, 0.04), 0 4px 12px rgba(0, 0, 0, 0.4);
}
.card.design-worn .card-type-indicator {
  background: linear-gradient(90deg, #6b5a3e, #8b7355, #6b5a3e);
  opacity: 0.7;
}

.card.design-frost {
  background: linear-gradient(135deg, #0d1926 0%, #132640 50%, #0a1e35 100%);
  border: 1px solid rgba(120, 180, 255, 0.2);
  box-shadow: inset 0 0 25px rgba(80, 150, 255, 0.04), 0 4px 12px rgba(0, 0, 0, 0.4);
}
.card.design-frost .card-type-indicator {
  background: linear-gradient(90deg, #3b82f6, #93c5fd, #3b82f6);
}
.card.design-frost:hover {
  border-color: rgba(120, 180, 255, 0.35);
}

.card.design-ember {
  background: linear-gradient(135deg, #1a0a0a 0%, #2a1008 50%, #1a0a0a 100%);
  border: 1px solid rgba(255, 100, 30, 0.2);
  box-shadow: inset 0 0 25px rgba(255, 80, 20, 0.04), 0 4px 12px rgba(0, 0, 0, 0.5);
}
.card.design-ember .card-type-indicator {
  background: linear-gradient(90deg, #dc2626, #f97316, #dc2626);
  box-shadow: 0 0 8px rgba(249, 115, 22, 0.4);
}
.card.design-ember:hover {
  border-color: rgba(255, 100, 30, 0.35);
  box-shadow: inset 0 0 25px rgba(255, 80, 20, 0.06), 0 0 12px rgba(249, 115, 22, 0.1), 0 6px 16px rgba(0, 0, 0, 0.5);
}

.card.design-shadow {
  background: rgba(5, 5, 8, 0.98);
  border: 1px solid rgba(60, 60, 70, 0.3);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), 0 2px 8px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}
.card.design-shadow .card-type-indicator {
  background: linear-gradient(90deg, #2a2a35, #3a3a45, #2a2a35);
}
.card.design-shadow:hover {
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), 0 4px 12px rgba(0, 0, 0, 0.6);
}

.card-type-indicator {
  height: 4px;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.card.character .card-type-indicator {
  background: var(--cyan);
}
.card.location .card-type-indicator {
  background: var(--green);
}
.card.item .card-type-indicator {
  background: var(--gold);
}
.card.note .card-type-indicator {
  background: var(--purple);
}
.card.quest .card-type-indicator {
  background: var(--ember);
}
.card.statblock .card-type-indicator {
  background: var(--rose);
}
.card.chart .card-type-indicator {
  background: var(--teal);
}
.card.bar .card-type-indicator {
  background: var(--hp-red);
}
.card.stress .card-type-indicator {
  background: var(--stress-orange);
}
.card.injury .card-type-indicator {
  background: var(--rose);
}
.card.body .card-type-indicator {
  background: var(--purple);
}
.card.image .card-type-indicator {
  background: var(--cyan, #4ecdc4);
}
.card.text .card-type-indicator {
  background: var(--gold, #d4a824);
}

.card-content {
  padding: 12px;
  display: flex;
  flex-direction: column;
  flex: 1;
}

.card-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 6px;
  text-align: center;
}

.card.hide-title .card-title {
  display: none;
}

.card.hide-title .card-type-indicator {
  display: none;
}

.card-description {
  font-size: 12px;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  flex: 1;
}

.card-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: auto;
  padding-top: 10px;
  justify-content: center;
}

.card.hide-tags .card-tags {
  display: none;
}

.card-tag {
  font-size: 10px;
  padding: 2px 6px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  color: var(--text-muted);
}

/* Resize Handle */
.resize-handle {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 16px;
  height: 16px;
  cursor: se-resize;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.resize-handle::after {
  content: '';
  position: absolute;
  bottom: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  border-right: 2px solid var(--text-muted);
  border-bottom: 2px solid var(--text-muted);
}

.card:hover .resize-handle {
  opacity: 1;
}

/* Image Card */
.card-image {
  width: 100%;
  height: auto;
  display: block;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* Chart Card */
.card-chart {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  flex: 1;
  min-height: 0;
}

.chart-visual {
  width: 100%;
  height: 100%;
  max-width: 120px;
  max-height: 120px;
  border-radius: 50%;
  position: relative;
  aspect-ratio: 1;
  margin: 0 auto;
}

.chart-visual.donut::after,
.chart-visual.ring::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--bg-dark);
  border-radius: 50%;
}

.chart-visual.donut::after {
  width: 50%;
  height: 50%;
}
.chart-visual.ring::after {
  width: 75%;
  height: 75%;
}

.chart-visual.gauge {
  aspect-ratio: 2;
  height: 100%;
  border-radius: 80px 80px 0 0;
}

/* Stat Block */
.card-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin-top: 8px;
  flex: 1;
}

.stat-item {
  text-align: center;
  padding: 4px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.stat-label {
  font-size: 9px;
  text-transform: uppercase;
}

.stat-value {
  font-size: clamp(12px, 3vw, 18px);
  font-weight: 700;
}

/* Bar Card */
.card-bars {
  padding: 8px 0;
}

.card-bar-item {
  margin-bottom: 8px;
}

.card-bar-item:last-child {
  margin-bottom: 0;
}

.card-bar-label {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  margin-bottom: 4px;
}

.card-bar {
  height: 16px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
}

.card-bar-fill {
  height: 100%;
  transition: width 0.3s ease;
}

.card-bar-fill.striped {
  background-image: linear-gradient(
    45deg,
    rgba(255, 255, 255, 0.1) 25%,
    transparent 25%,
    transparent 50%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0.1) 75%,
    transparent 75%
  );
  background-size: 20px 20px;
}

.card-bar-fill.segmented {
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 18px,
    rgba(0, 0, 0, 0.3) 18px,
    rgba(0, 0, 0, 0.3) 20px
  );
}

/* Stress/Clock Card */
.stress-display {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  justify-content: center;
  align-items: center;
  padding: 8px;
  flex: 1;
  min-height: 0;
}

.stress-segment {
  width: 24px;
  height: 24px;
  border: 2px solid currentColor;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.stress-segment.boxes {
  border-radius: 3px;
}
.stress-segment.circles {
  border-radius: 50%;
}
.stress-segment.diamonds {
  transform: rotate(45deg);
}
.stress-segment.slashes {
  border: none;
  font-weight: bold;
}

.stress-segment.filled {
  background: currentColor;
}
.stress-segment.filled::after {
  content: '';
  color: var(--bg-dark);
}

/* Clock style - SVG based */
.clock-svg {
  display: block;
  max-width: 120px;
  max-height: 120px;
  margin: 0 auto;
}

.clock-svg .stress-segment {
  transition: opacity 0.15s;
}

.clock-svg .stress-segment:hover {
  opacity: 0.75;
}

/* Fill Pattern Styles - for non-clock stress segments */
.stress-segment.filled.fill-striped {
  background: repeating-linear-gradient(
    45deg,
    var(--fill-color, #f97316),
    var(--fill-color, #f97316) 4px,
    transparent 4px,
    transparent 8px
  );
}

.stress-segment.filled.fill-gradient {
  background: linear-gradient(
    135deg,
    var(--fill-color, #f97316) 0%,
    rgba(249, 115, 22, 0.3) 100%
  );
}

.stress-segment.filled.fill-outline {
  background: transparent;
  border: 3px solid var(--fill-color, #f97316);
}

.stress-segment.filled.fill-crosshatch {
  background:
    repeating-linear-gradient(
      45deg,
      var(--fill-color, #f97316),
      var(--fill-color, #f97316) 2px,
      transparent 2px,
      transparent 6px
    ),
    repeating-linear-gradient(
      -45deg,
      var(--fill-color, #f97316),
      var(--fill-color, #f97316) 2px,
      transparent 2px,
      transparent 6px
    );
}

.stress-segment.filled.fill-dots {
  background:
    radial-gradient(circle 2px, var(--fill-color, #f97316) 100%, transparent 100%);
  background-size: 6px 6px;
}

.stress-segment.filled.fill-glow {
  background: var(--fill-color, #f97316);
  box-shadow: inset 0 0 12px rgba(255,255,255,0.3), 0 0 8px var(--fill-color, #f97316);
  animation: glowPulse 2s infinite ease-in-out;
}

@keyframes glowPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.stress-segment.filled.fill-diamond-pattern {
  background:
    linear-gradient(45deg, var(--fill-color, #f97316) 25%, transparent 25%),
    linear-gradient(-45deg, var(--fill-color, #f97316) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--fill-color, #f97316) 75%),
    linear-gradient(-45deg, transparent 75%, var(--fill-color, #f97316) 75%);
  background-size: 8px 8px;
  background-position: 0 0, 0 4px, 4px -4px, -4px 0px;
}

/* Injury Track */
.injury-track {
  margin-bottom: 12px;
}

.injury-track-name {
  font-size: 11px;
  margin-bottom: 4px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.injury-boxes {
  display: flex;
  gap: 3px;
}

.injury-boxes-grid {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.injury-box-container {
  display: flex;
  align-items: flex-start;
  gap: 6px;
}

.injury-box {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  margin-top: 2px;
  border: 2px solid var(--rose);
  border-radius: 3px;
  cursor: pointer;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
}

.injury-text-field {
  flex: 1;
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(212, 168, 36, 0.15);
  border-radius: 3px;
  padding: 3px 6px;
  font-size: 10px;
  font-family: inherit;
  color: inherit;
  transition: all 0.15s ease;
  resize: none;
  overflow: hidden;
  min-height: 22px;
  line-height: 1.4;
}

.injury-text-field:hover {
  border-color: rgba(212, 168, 36, 0.25);
  background: rgba(0, 0, 0, 0.3);
}

.injury-text-field:focus {
  outline: none;
  border-color: var(--gold);
  background: rgba(0, 0, 0, 0.4);
  box-shadow: 0 0 0 2px rgba(212, 168, 36, 0.1);
}

.injury-text-field::placeholder {
  color: rgba(168, 152, 128, 0.3);
}

.injury-box.filled {
  background: var(--rose);
  color: white;
}
.injury-box.crossed::after {
  content: '';
}

.injury-note {
  width: 100%;
  margin: 6px 0 8px;
  padding: 8px 10px;
  border-radius: var(--radius-md);
  border: 1px solid rgba(212, 168, 36, 0.18);
  background: rgba(255, 255, 255, 0.03);
  color: var(--text);
  font-size: 12px;
}

/* Body Map */
.body-map {
  flex: 1;
  min-height: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: crosshair;
}

.body-map-inner {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.body-silhouette-img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
  user-select: none;
  pointer-events: none;
}

.body-overlay {
  position: absolute;
  inset: 0;
  border-radius: 12px;
  pointer-events: none;
  mix-blend-mode: screen;
}

.body-silhouette {
  width: auto;
  height: 100%;
  max-width: 100%;
  max-height: 180px;
}

.body-point {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  animation: pulse 2s infinite;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.8), 0 0 16px currentColor,
    0 0 8px currentColor, 0 0 24px currentColor;
  z-index: 10;
  border: 2px solid rgba(255,255,255,0.3);
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    opacity: 0.7;
    transform: translate(-50%, -50%) scale(1.1);
  }
}

/* Text Card */
.card.text {
  overflow: hidden;
}
.card.text .card-content {
  padding: 16px;
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 100%;
}

.card.text .card-title {
  text-align: inherit;
  flex-shrink: 0;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.card.text .card-description {
  flex: 1;
  min-height: 0;
  overflow: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;
  opacity: 0.85;
}

.card.text.heading1 .card-title {
  font-size: 24px;
  font-family: 'Cinzel', serif;
}

.card.text.heading2 .card-title {
  font-size: 20px;
  font-family: 'Cinzel', serif;
}

.card.text.heading3 .card-title {
  font-size: 16px;
  font-weight: 600;
}

.card.text.caption .card-title {
  font-size: 12px;
  font-style: italic;
}

/* Chart SVG */
.chart-visual-svg {
  width: 100%;
  flex: 1;
  min-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 4px;
}
.chart-visual-svg svg {
  max-width: 100%;
  max-height: 100%;
}

/* New Card Type Indicators */
.card.personality .card-type-indicator { background: #c084fc; }
.card.attributes .card-type-indicator { background: #60a5fa; }
.card.inventory .card-type-indicator { background: #a78bfa; }
.card.currency .card-type-indicator { background: #fbbf24; }
.card.mood .card-type-indicator { background: #e879a8; }
.card.mood { min-width: 200px; }

/* Item Card Styles */
.item-card-content {
  padding: 4px 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.item-header-row {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}
.item-type-icon { font-size: 16px; }
.item-rarity-badge {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 1px 6px;
  border: 1px solid;
  border-radius: 3px;
  font-weight: 600;
}
.item-load-display { font-size: 10px; margin-left: auto; letter-spacing: 2px; }
.item-desc { font-size: 11px; line-height: 1.4; opacity: 0.85; }
.item-effect {
  font-size: 10px;
  line-height: 1.3;
  padding: 4px 6px;
  background: rgba(212, 168, 36, 0.08);
  border-left: 2px solid rgba(212, 168, 36, 0.3);
  border-radius: 0 3px 3px 0;
}
.item-uses { font-size: 10px; display: flex; gap: 6px; }
.item-props-row { display: flex; flex-wrap: wrap; gap: 4px; }
.item-prop-tag {
  font-size: 9px;
  padding: 1px 5px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(168, 152, 128, 0.2);
  border-radius: 3px;
  color: var(--text-secondary);
}
.item-prop-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
}

/* Personality Card */
.personality-card-content {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 2px 0;
}
.personality-trait-row {
  display: flex;
  gap: 8px;
  align-items: flex-start;
  padding: 4px 0;
  border-bottom: 1px solid rgba(168, 152, 128, 0.1);
}
.personality-trait-row:last-child { border-bottom: none; }
.personality-trait-icon {
  font-size: 14px;
  color: var(--gold);
  flex-shrink: 0;
  width: 18px;
  text-align: center;
  filter: drop-shadow(0 0 4px rgba(212, 168, 36, 0.3));
}
.personality-trait-body { display: flex; flex-direction: column; gap: 1px; flex: 1; min-width: 0; }
.personality-trait-label {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--gold);
  font-weight: 600;
}
.personality-trait-value {
  font-size: 11px;
  line-height: 1.3;
  word-wrap: break-word;
}
.personality-edit-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
}

/* Attributes / Character Profile Card */
.attributes-card-content {
  display: flex;
  flex-direction: column;
  gap: 1px;
  padding: 2px 0;
}
.attr-category-badge {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 1px 6px;
  border: 1px solid;
  border-radius: 3px;
  font-weight: 600;
  align-self: flex-start;
  margin-bottom: 4px;
}
.attr-profile-row {
  display: flex;
  gap: 8px;
  padding: 3px 0;
  border-bottom: 1px solid rgba(168, 152, 128, 0.08);
}
.attr-profile-row:last-child { border-bottom: none; }
.attr-profile-label {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--gold);
  font-weight: 600;
  width: 72px;
  flex-shrink: 0;
  padding-top: 1px;
}
.attr-profile-value {
  font-size: 11px;
  line-height: 1.3;
  flex: 1;
  word-wrap: break-word;
}
.attr-edit-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
}

/* Inventory Card */
.inventory-card-content {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 2px 0;
}
.inv-load-bar {
  height: 8px;
  background: rgba(255,255,255,0.06);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}
.inv-load-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s ease;
}
.inv-load-text {
  position: absolute;
  right: 4px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 7px;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}
.inv-items-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.inv-item-row {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 2px 4px;
  border-radius: 3px;
  background: rgba(255,255,255,0.02);
}
.inv-item-row:hover { background: rgba(255,255,255,0.05); }
.inv-item-qty { font-size: 10px; font-weight: 700; width: 24px; }
.inv-item-name { font-size: 10px; flex: 1; }
.inv-item-load { font-size: 8px; color: var(--text-muted); letter-spacing: 1px; }
.inv-edit-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
}

/* Currency Card */
.currency-card-content {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 2px 0;
}
.currency-purse {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.currency-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 3px 6px;
  border-radius: 4px;
  background: rgba(255,255,255,0.03);
}
.currency-row:hover { background: rgba(255,255,255,0.06); }
.currency-icon {
  font-size: 14px;
  color: var(--gold);
  width: 20px;
  text-align: center;
  filter: drop-shadow(0 0 4px rgba(212, 168, 36, 0.4));
}
.currency-name { font-size: 11px; flex: 1; }
.currency-amount {
  font-size: 14px;
  font-weight: 700;
  color: var(--gold);
  font-family: 'Cinzel', serif;
  min-width: 30px;
  text-align: right;
}
.currency-stash {
  border-top: 1px solid rgba(168, 152, 128, 0.15);
  padding-top: 6px;
}
.stash-label {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 4px;
  opacity: 0.6;
}
.stash-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px 6px;
  font-size: 10px;
}
.stash-amount { font-weight: 600; color: var(--text-secondary); }
.currency-edit-row, .stash-edit-row {
  display: flex;
  gap: 4px;
  align-items: center;
  margin-bottom: 4px;
}

/* Mood Card */
.mood-card-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
}
.mood-face {
  font-size: 36px;
  line-height: 1;
  filter: drop-shadow(0 0 10px currentColor);
  transition: filter 0.3s ease;
}
.mood-track {
  width: 100%;
  padding: 0 6px;
}
.mood-track-bg {
  height: 12px;
  border-radius: 6px;
  position: relative;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.05);
  cursor: pointer;
  transition: box-shadow 0.2s ease;
}
.mood-track-bg:hover {
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 8px rgba(255,255,255,0.1);
}
.mood-thumb {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.9);
  box-shadow: 0 0 8px rgba(0,0,0,0.6), 0 0 16px currentColor;
  transition: left 0.15s ease, box-shadow 0.2s ease;
  pointer-events: none;
}
.mood-track-bg:hover .mood-thumb {
  box-shadow: 0 0 10px rgba(0,0,0,0.6), 0 0 20px currentColor, 0 0 30px currentColor;
}
.mood-labels {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 0 6px;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  font-weight: 500;
}
.mood-value {
  font-size: 16px;
  font-weight: 700;
  font-family: 'Cinzel', serif;
}
.mood-slider-input {
  width: 100%;
  accent-color: var(--gold);
}

/* Connection Lines */
.connection-line {
  fill: none;
  opacity: 0.75;
}

.connection-line.active {
  opacity: 1;
  filter: drop-shadow(0 0 6px rgba(212, 168, 36, 0.45));
}

.connection-line.selected-connection {
  opacity: 1;
  filter: drop-shadow(0 0 8px rgba(78, 205, 196, 0.55));
}

/* Wide invisible hit area so connections are easy to select */
.connection-hit {
  fill: none;
  stroke: transparent;
  stroke-width: 16;
  opacity: 0;
}

.connection-hit:hover {
  opacity: 0.05;
}

/* ============================================
       Write View
       ============================================ */
.write-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--bg-medium);
  overflow: hidden;
}

.write-container.hidden {
  display: none;
}

.write-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  background: var(--bg-dark);
  border-bottom: 1px solid var(--border-color);
}

.write-chapter-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.write-chapter-label-input {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  background: transparent;
  border: none;
  border-bottom: 1px solid transparent;
  padding: 2px 0;
  width: 120px;
}

.write-chapter-label-input:hover {
  border-color: var(--border-light);
}
.write-chapter-label-input:focus {
  outline: none;
  border-color: var(--gold);
  color: var(--text-secondary);
}

.write-chapter-title {
  font-family: 'Cinzel', serif;
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  background: transparent;
  border: none;
  border-bottom: 1px solid transparent;
  padding: 4px 0;
  min-width: 300px;
}

.write-chapter-title:hover {
  border-color: var(--border-light);
}
.write-chapter-title:focus {
  outline: none;
  border-color: var(--gold);
}

.write-stats {
  display: flex;
  align-items: center;
  gap: 16px;
}

.word-count {
  font-size: 13px;
  color: var(--text-secondary);
}
.save-status {
  font-size: 12px;
  color: var(--online);
}

/* Toolbar */
.write-toolbar {
  display: flex;
  align-items: center;
  gap: 3px;
  padding: 6px 12px;
  background: linear-gradient(180deg, #1a1816 0%, #131110 100%);
  border-bottom: 1px solid rgba(212, 168, 36, 0.25);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(245, 237, 224, 0.04);
  flex-wrap: nowrap;
  overflow-x: auto;
  scrollbar-width: none;
}

.write-toolbar::-webkit-scrollbar {
  display: none;
}

.write-toolbar .toolbar-select.sm {
  padding: 4px 6px;
  font-size: 11px;
  max-width: 130px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  cursor: pointer;
}

.write-toolbar .toolbar-select.xs {
  padding: 4px 4px;
  font-size: 11px;
  width: 44px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  cursor: pointer;
}

.write-toolbar-divider {
  width: 1px;
  height: 20px;
  background: rgba(212, 168, 36, 0.15);
  margin: 0 3px;
  flex-shrink: 0;
}

.write-tool-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition-fast);
  flex-shrink: 0;
  padding: 0;
}

.write-tool-btn:hover {
  background: rgba(212, 168, 36, 0.1);
  border-color: rgba(212, 168, 36, 0.2);
  color: var(--gold);
}

.write-tool-btn.active {
  background: rgba(212, 168, 36, 0.15);
  border-color: rgba(212, 168, 36, 0.3);
  color: var(--gold);
}

.write-tool-text {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: -0.02em;
}

.write-tool-color {
  width: 22px;
  height: 22px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  padding: 0;
  background: transparent;
  flex-shrink: 0;
}

.write-tool-color::-webkit-color-swatch-wrapper { padding: 1px; }
.write-tool-color::-webkit-color-swatch { border: none; border-radius: 2px; }

.toolbar-select {
  padding: 6px 10px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(212, 168, 36, 0.25);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.toolbar-select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(212, 168, 36, 0.1);
}

.toolbar-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.toolbar-btn:hover {
  background: rgba(212, 168, 36, 0.1);
  border-color: rgba(212, 168, 36, 0.2);
  color: var(--gold);
}

.toolbar-btn.active {
  background: rgba(212, 168, 36, 0.15);
  border-color: rgba(212, 168, 36, 0.3);
  color: var(--gold);
  box-shadow: 0 0 6px rgba(212, 168, 36, 0.15);
}

.toolbar-divider {
  width: 1px;
  height: 20px;
  background: rgba(212, 168, 36, 0.2);
  margin: 0 8px;
}

.toolbar-color-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.toolbar-color-group label {
  font-size: 10px;
  color: var(--text-muted);
}

.toolbar-color {
  width: 28px;
  height: 28px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  padding: 0;
}

/* Editor */
.write-editor-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  padding: 40px 24px;
  overflow-y: auto;
}

.write-editor {
  width: 100%;
  max-width: 720px;
  min-height: 100%;
  background: transparent;
  color: var(--text-primary);
  font-family: 'Inter', sans-serif;
  font-size: 16px;
  line-height: 1.8;
  outline: none;
}

.write-editor:empty:before {
  content: 'Start writing...';
  color: var(--text-muted);
}

.write-editor h1 {
  font-family: 'Cinzel', serif;
  font-size: 28px;
  margin: 24px 0 16px;
  color: var(--gold);
}

.write-editor h2 {
  font-family: 'Cinzel', serif;
  font-size: 22px;
  margin: 20px 0 12px;
}

.write-editor h3 {
  font-size: 18px;
  font-weight: 600;
  margin: 16px 0 10px;
}

.write-editor blockquote {
  border-left: 3px solid var(--gold);
  padding-left: 16px;
  margin: 16px 0;
  color: var(--text-secondary);
  font-style: italic;
}

.write-editor ul,
.write-editor ol {
  margin: 12px 0;
  padding-left: 24px;
}

.write-editor li {
  margin: 6px 0;
}

.write-editor a {
  color: var(--gold);
  text-decoration: underline;
}

.write-editor table {
  width: auto;
  min-width: 50%;
  border-collapse: collapse;
  margin: 16px 0;
  table-layout: auto;
  display: table;
}

.write-editor table + br,
.write-editor table + p:empty {
  display: none;
}

.write-editor th,
.write-editor td {
  border: 1px solid var(--border-light);
  padding: 10px 12px;
  text-align: left;
  position: relative;
  min-width: 50px;
  overflow: hidden;
}

.write-editor th {
  background: var(--bg-lighter);
  font-weight: 600;
}

/* Column resize handle */
.write-editor th::after,
.write-editor td::after {
  content: '';
  position: absolute;
  right: 0;
  top: 0;
  height: 100%;
  width: 5px;
  cursor: col-resize;
  background: transparent;
}

.write-editor th:hover::after,
.write-editor td:hover::after {
  background: var(--gold);
  opacity: 0.5;
}

/* Row resize handle */
.write-editor tr {
  position: relative;
}

.write-editor tr::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 5px;
  cursor: row-resize;
  background: transparent;
}

.write-editor tr:hover::after {
  background: var(--gold);
  opacity: 0.3;
}

.write-editor img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
  margin: 16px 0;
  cursor: pointer;
}

/* Image alignment */
.editor-image-wrapper {
  display: block;
  position: relative;
  margin: 16px 0;
  max-width: 100%;
}

.editor-image-wrapper.align-left {
  margin-right: auto;
  text-align: left;
}

.editor-image-wrapper.align-center {
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

.editor-image-wrapper.align-right {
  margin-left: auto;
  text-align: right;
}

.editor-image {
  display: inline-block;
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
}

.image-resize-handle {
  position: absolute;
  bottom: 4px;
  right: 4px;
  width: 16px;
  height: 16px;
  background: var(--gold);
  border-radius: 2px;
  cursor: se-resize;
  opacity: 0;
  transition: opacity 0.15s;
}

.image-resize-handle::after {
  content: '';
  position: absolute;
  bottom: 3px;
  right: 3px;
  width: 8px;
  height: 8px;
  border-bottom: 2px solid var(--bg-dark);
  border-right: 2px solid var(--bg-dark);
}

.editor-image-wrapper:hover .image-resize-handle {
  opacity: 1;
}

/* Column Layouts in Editor */
.editor-columns {
  display: flex;
  gap: 16px;
  margin: 16px 0;
  padding: 8px;
  border: 1px dashed var(--border-light);
  border-radius: var(--radius-md);
}
.editor-columns.borderless {
  border: none;
  padding: 0;
}

.editor-column {
  min-height: 60px;
  padding: 12px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
}
.editor-columns.borderless .editor-column {
  background: transparent;
}

.editor-column:focus {
  outline: 2px solid var(--gold);
}

/* Columns Modal */
.column-layouts {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.column-layout-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 16px 12px;
  background: var(--bg-medium);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition-fast);
}

.column-layout-btn:hover {
  border-color: var(--gold);
  background: var(--gold-subtle);
}

.layout-preview {
  display: flex;
  gap: 4px;
  width: 80px;
  height: 40px;
}

.layout-preview span {
  flex: 1;
  background: var(--text-muted);
  border-radius: 2px;
  opacity: 0.5;
}

.column-layout-btn:hover .layout-preview span {
  background: var(--gold);
  opacity: 0.8;
}

.column-layout-btn span:last-child {
  font-size: 11px;
  color: var(--text-secondary);
}

.write-editor img.resizable {
  resize: horizontal;
  overflow: auto;
}

/* ============================================
       Write Footer (Tags & Associations)
       ============================================ */
.write-footer {
  display: flex;
  gap: 24px;
  padding: 16px 24px;
  background: var(--bg-dark);
  border-top: 1px solid var(--border-color);
  flex-shrink: 0;
}

.write-footer-section {
  flex: 1;
  min-width: 0;
}

.write-footer-label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 8px;
}

.write-footer-input {
  width: 100%;
  padding: 8px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
}

.write-footer-input:focus {
  border-color: var(--gold-dark);
  outline: none;
}

.write-footer-input::placeholder {
  color: var(--text-muted);
}

.write-associations {
  position: relative;
}

.write-footer .associations-list {
  margin-top: 8px;
  max-height: 100px;
  overflow-y: auto;
}

/* ============================================
       Details Panel
       ============================================ */
.details-panel {
  width: 300px;
  background: var(--bg-dark);
  border-left: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  transition: width var(--transition-normal);
  overflow: hidden;
}

.details-panel.collapsed {
  width: 0;
  border-left: none;
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
}

.panel-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
}

.close-btn {
  width: 28px;
  height: 28px;
}

.panel-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

.empty-state {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-muted);
  font-size: 13px;
  text-align: center;
  padding: 20px;
}

.card-details.hidden {
  display: none;
}
.pin-details.hidden {
  display: none;
}
.chapter-details.hidden {
  display: none;
}

.chapter-detail-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

/* Chapter Tag Pills */
.chapter-tags-display {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-top: 8px;
}

.chapter-tag-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  padding: 3px 8px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  color: var(--text-muted);
  line-height: 1.2;
}

.chapter-tag-remove {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  line-height: 1;
  padding: 0 1px;
  opacity: 0.5;
  transition: opacity 0.15s ease, color 0.15s ease;
}

.chapter-tag-remove:hover {
  opacity: 1;
  color: #f43f5e;
}

.detail-section {
  margin-bottom: 16px;
}
.detail-section.hidden {
  display: none;
}

.detail-label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  margin-bottom: 8px;
}

.detail-input,
.detail-select {
  width: 100%;
  padding: 10px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 13px;
  transition: var(--transition-fast);
}

.detail-input:focus,
.detail-select:focus {
  outline: none;
  border-color: var(--gold-dark);
}

.detail-select.sm {
  padding: 6px 8px;
  font-size: 12px;
}

.detail-input.sm {
  padding: 6px 8px;
  font-size: 12px;
  width: auto;
}

.detail-input[type="number"] {
  font-weight: 500;
  text-align: center;
  font-variant-numeric: tabular-nums;
}

.detail-textarea {
  width: 100%;
  min-height: 80px;
  padding: 10px 12px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 13px;
  resize: vertical;
  font-family: inherit;
  line-height: 1.5;
}

.detail-textarea:focus {
  outline: none;
  border-color: var(--gold-dark);
}

/* Pin Details */
.pin-detail-name {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
}

.pin-detail-description {
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-secondary);
}

.pin-linked-card {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  font-size: 13px;
  color: var(--text-secondary);
}

.pin-linked-card .linked-card-color {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  flex-shrink: 0;
}

.pin-linked-card .linked-card-name {
  color: var(--gold);
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dashed;
}

.pin-linked-card .linked-card-name:hover {
  color: var(--gold-light);
}

/* Style Row */
.style-row {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
}

.color-input-group {
  display: flex;
  align-items: center;
  gap: 6px;
}

.color-input-group label {
  font-size: 11px;
  color: var(--text-muted);
}

.detail-color {
  width: 40px;
  height: 34px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  padding: 2px;
  background: var(--bg-medium);
}
.detail-color:hover {
  border-color: var(--gold-dark);
}

/* Alignment */
.align-buttons {
  display: flex;
  gap: 4px;
}

.align-btn {
  flex: 1;
  padding: 8px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition-fast);
}

.align-btn:hover {
  color: var(--text-primary);
}

.align-btn.active {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
  color: var(--gold);
}

/* Settings Row */
.setting-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.setting-row:last-child {
  margin-bottom: 0;
}

.setting-row label {
  width: 70px;
  font-size: 12px;
  color: var(--text-secondary);
}

.setting-row input,
.setting-row select {
  flex: 1;
  padding: 8px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
}

.setting-row input[type='number'] {
  font-weight: 500;
  text-align: center;
  font-variant-numeric: tabular-nums;
}

.setting-row input[type='color'] {
  width: 44px;
  height: 34px;
  padding: 2px;
  cursor: pointer;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-medium);
}
.setting-row input[type='color']:hover {
  border-color: var(--gold-dark);
}

.setting-hint {
  font-size: 11px;
  color: var(--text-muted);
  font-style: italic;
  margin-top: 12px;
}

/* Image Preview */
.detail-image-preview {
  position: relative;
  margin-bottom: 16px;
  border-radius: var(--radius-md);
  overflow: hidden;
}

.detail-image-preview.hidden {
  display: none;
}

.detail-image-preview img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
}

.remove-image-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 24px;
  height: 24px;
  background: rgba(0, 0, 0, 0.7);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-image-btn:hover {
  background: var(--rose);
}

/* Stat Grid */
.stat-grid {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.stat-input-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.stat-input-row input[type='text'] {
  flex: 1;
  padding: 8px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
}

.stat-input-row input[type='number'] {
  width: 60px;
  padding: 8px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
  text-align: center;
}

.stat-input-row .remove-btn,
.bar-item-row .remove-btn,
.chart-data-item .remove-btn,
.injury-track-row .remove-btn {
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 4px;
}

.stat-input-row .remove-btn:hover,
.bar-item-row .remove-btn:hover,
.chart-data-item .remove-btn:hover,
.injury-track-row .remove-btn:hover {
  color: var(--rose);
}

/* Chart Data */
.chart-type-select,
.chart-fill-select {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.chart-type-select label,
.chart-fill-select label {
  font-size: 12px;
  color: var(--text-secondary);
  width: 80px;
}

.chart-data-item {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
  align-items: center;
}

.chart-data-item input[type='text'] {
  flex: 1;
  padding: 8px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
}

.chart-data-item input[type='number'] {
  width: 60px;
  padding: 8px 6px;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
  text-align: center;
  font-weight: 500;
}

.chart-data-item input[type='color'] {
  width: 40px;
  height: 36px;
  padding: 2px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  background: var(--bg-medium);
}
.chart-data-item input[type='color']:hover {
  border-color: var(--gold-dark);
}

/* Bar Items */
.bars-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.bar-item-row {
  padding: 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
}

.bar-item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.bar-item-header input {
  flex: 1;
  padding: 4px 8px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 500;
}

.bar-item-header input:hover {
  border-color: var(--border-light);
}
.bar-item-header input:focus {
  outline: none;
  border-color: var(--gold-dark);
}

.bar-item-inputs {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

.bar-item-inputs input[type="number"] {
  width: 60px;
  padding: 7px 8px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 500;
  text-align: center;
}

.bar-item-inputs input[type="color"] {
  width: 40px;
  height: 34px;
  padding: 2px;
  background: var(--bg-medium);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
}
.bar-item-inputs input[type="color"]:hover {
  border-color: var(--gold-dark);
}

.bar-item-inputs select {
  padding: 7px 8px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
  flex: 1;
  min-width: 70px;
}

/* Injury Tracks */
.injury-track-row {
  padding: 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
}

.injury-track-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.injury-track-header input {
  flex: 1;
  padding: 4px 8px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
}

.injury-track-inputs {
  display: flex;
  gap: 8px;
  align-items: center;
}

.injury-track-inputs label {
  font-size: 11px;
  color: var(--text-muted);
}

.injury-track-inputs input {
  width: 50px;
  padding: 6px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 12px;
  text-align: center;
}

.add-btn-full {
  width: 100%;
  padding: 8px;
  background: transparent;
  border: 1px dashed var(--border-light);
  border-radius: var(--radius-sm);
  color: var(--text-muted);
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition-fast);
  margin-top: 8px;
}

.add-btn-full:hover {
  border-color: var(--gold-dark);
  color: var(--gold);
}

/* Connections */
.connections-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 10px;
}

.connection-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  font-size: 12px;
  color: var(--text-secondary);
}

.connection-color {
  width: 8px;
  height: 8px;
  border-radius: 2px;
  flex-shrink: 0;
}

.connection-text {
  flex: 1;
}

.connection-remove {
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 0 4px;
}

.connection-remove:hover {
  color: var(--rose);
}

.add-connection-btn {
  width: 100%;
  padding: 8px;
  background: transparent;
  border: 1px dashed var(--border-light);
  border-radius: var(--radius-sm);
  color: var(--text-muted);
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition-fast);
}

.add-connection-btn:hover {
  border-color: var(--gold-dark);
  color: var(--gold);
}

/* ============================================
       Status Bar
       ============================================ */
.status-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  height: 28px;
  background: var(--bg-dark);
  border-top: 1px solid var(--border-color);
  flex-shrink: 0;
}

.status-left,
.status-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.status-item {
  font-size: 11px;
  color: var(--text-muted);
}

.status-item.connected {
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--online);
}

.status-dot {
  width: 6px;
  height: 6px;
  background: var(--online);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--online-glow);
}

.sync-pill {
  font-size: 10px;
  padding: 1px 8px;
  border-radius: 10px;
  white-space: nowrap;
}
.sync-pill.synced { color: #22c55e; background: rgba(34,197,94,0.08); }
.sync-pill.syncing { color: var(--gold); background: rgba(212,168,36,0.08); }
.sync-pill.error { color: #ef4444; background: rgba(239,68,68,0.08); }

/* ============================================
       Utilities
       ============================================ */
.hidden {
  display: none !important;
}

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-track {
  background: var(--bg-dark);
}
::-webkit-scrollbar-thumb {
  background: var(--bg-lighter);
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--bg-hover);
}

/* ============================================
       Tags Section
       ============================================ */
.tags-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.empty-tags-message {
  font-size: 12px;
  color: var(--text-muted);
  text-align: center;
  padding: 16px 0;
  font-style: italic;
  width: 100%;
}

.tag-cloud-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition-fast);
}

.tag-cloud-item:hover {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
  color: var(--gold);
}

.tag-count {
  font-size: 10px;
  padding: 1px 5px;
  background: var(--bg-medium);
  border-radius: 8px;
  color: var(--text-muted);
}

/* Pin Detail Tags */
.pin-detail-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.pin-tag {
  display: inline-block;
  padding: 4px 10px;
  background: var(--bg-lighter);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  font-size: 11px;
  color: var(--text-secondary);
}

.pin-tag.clickable {
  cursor: pointer;
  transition: var(--transition-fast);
}

.pin-tag.clickable:hover {
  background: var(--gold-subtle);
  border-color: var(--gold-dark);
  color: var(--gold);
}

/* ============================================
       Tag Finder Panel
       ============================================ */
.tag-finder-panel {
  position: fixed;
  right: 320px;
  top: 100px;
  width: 280px;
  max-height: 400px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  z-index: 500;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.tag-finder-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--bg-medium);
  border-bottom: 1px solid var(--border-color);
}

.tag-finder-title {
  font-size: 13px;
  color: var(--text-secondary);
}

.tag-finder-title strong {
  color: var(--gold);
}

.tag-finder-results {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.tag-finder-empty {
  padding: 20px;
  text-align: center;
  font-size: 13px;
  color: var(--text-muted);
  font-style: italic;
}

.tag-finder-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition-fast);
}

.tag-finder-item:hover {
  background: var(--bg-hover);
}

.tag-finder-icon {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
}

.tag-finder-icon.card-icon {
  border-radius: 3px;
}

.tag-finder-info {
  flex: 1;
  min-width: 0;
}

.tag-finder-name {
  display: block;
  font-size: 13px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.tag-finder-location {
  display: block;
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
}

/* ============================================
       Map Editor Modal
       ============================================ */
.map-image-preview {
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.map-image-preview img {
  max-width: 100%;
  max-height: 200px;
  border-radius: var(--radius-sm);
  display: block;
  object-fit: contain;
}

.map-image-preview img.hidden {
  display: none;
}

.map-image-preview .btn {
  align-self: center;
}

.scale-settings {
  background: var(--bg-medium);
  border-radius: var(--radius-md);
  padding: 12px;
}

.scale-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.scale-row span {
  color: var(--text-secondary);
  font-size: 13px;
}

.popup-input.sm,
.popup-select.sm {
  width: auto;
  flex: 1;
  min-width: 60px;
}

/* Map Item Edit Button */
.edit-item-btn {
  opacity: 0;
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 12px;
  padding: 2px 6px;
  transition: var(--transition-fast);
}

.map-item:hover .edit-item-btn {
  opacity: 1;
}

.edit-item-btn:hover {
  color: var(--gold);
}

/* ============================================
       Measurement
       ============================================ */
.measurement-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 50;
  overflow: visible;
}

.measurement-layer.hidden {
  display: none;
}

.measurement-line {
  stroke: var(--gold);
  stroke-width: 2.5;
  stroke-dasharray: 8, 4;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.6)) drop-shadow(0 0 6px rgba(212, 168, 36, 0.3));
  stroke-linecap: round;
}

.measurement-point {
  fill: var(--gold);
  stroke: rgba(255, 255, 255, 0.95);
  stroke-width: 2.5;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.6));
  r: 6;
}

.measurement-display {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  background: rgba(10, 8, 6, 0.95);
  border: 1px solid var(--gold-dark);
  border-radius: var(--radius-lg);
  z-index: 100;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5), 0 0 1px rgba(212, 168, 36, 0.3);
  backdrop-filter: blur(12px);
}

.measurement-display.hidden {
  display: none;
}

.measurement-value {
  font-size: 18px;
  font-weight: 600;
  color: var(--gold);
  font-family: 'Cinzel', serif;
  letter-spacing: 0.02em;
}

/* ============================================
       Pin Context Menu
       ============================================ */
#pinContextMenu {
  min-width: 160px;
}

/* ============================================
       Search Input with Results
       ============================================ */

/* ============================================
       Inline Search Dropdowns (Associations)
       ============================================ */
.search-input-wrapper {
  position: relative;
}

.search-input-wrapper .search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-top: none;
  border-radius: 0 0 var(--radius-md) var(--radius-md);
  max-height: 200px;
  overflow-y: auto;
  z-index: 100;
  box-shadow: var(--shadow-md);
  padding: 4px;
}

.search-input-wrapper .search-results.hidden {
  display: none;
}

.search-result-color {
  width: 12px !important;
  height: 12px !important;
  min-width: 12px !important;
  min-height: 12px !important;
  max-width: 12px !important;
  max-height: 12px !important;
  border-radius: 3px;
  flex: 0 0 12px;
  flex-shrink: 0;
  display: inline-block !important;
  align-self: center;
  margin-right: 0;
}

.search-result-color.type-pin {
  border-radius: 50%;
}

/* ============================================
       Linked Pin Display (Card Details)
       ============================================ */
.linked-pin-display {
  margin-top: 8px;
}

.linked-pin-display.hidden {
  display: none;
}

.linked-pin-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: var(--bg-medium);
  border-radius: var(--radius-sm);
  font-size: 13px;
}

.linked-pin-color {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.linked-pin-name {
  color: var(--gold);
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dashed;
}

.linked-pin-name:hover {
  color: var(--gold-light);
}

.linked-pin-map {
  font-size: 11px;
  color: var(--text-muted);
  margin-left: auto;
}

.remove-linked-pin {
  background: transparent;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 16px;
  padding: 0 4px;
  transition: var(--transition-fast);
}

.remove-linked-pin:hover {
  color: var(--rose);
}

/* ============================================
       Wiki Link Modal
       ============================================ */
#wikiLinkSearchResults {
  position: relative;
  max-height: 200px;
  overflow-y: auto;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  margin-top: 8px;
}

.wiki-link-preview {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: var(--gold-subtle);
  border: 1px solid var(--gold-dark);
  border-radius: var(--radius-md);
  margin-top: 12px;
}

.wiki-link-preview.hidden {
  display: none;
}

.wiki-link-preview .wiki-link-type {
  font-size: 12px;
  color: var(--text-muted);
}

.wiki-link-preview .wiki-link-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--gold);
}

/* --- PATCH: association color swatch should not overlap text --- */
.association-item,
.connection-item {
  display: flex;
  align-items: center;
  gap: 10px;
}
.association-color,
.connection-color {
  flex: 0 0 12px;
  width: 12px;
  height: 12px;
  border-radius: 3px;
  margin-right: 0;
}
.association-text,
.connection-text {
  flex: 1 1 auto;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* --- PATCH: destination markers (map view) --- */
.destination-marker {
  position: absolute;
  transform: translate(-50%, -50%) scale(var(--dest-scale, 1));
  cursor: pointer;
  z-index: 15;
  pointer-events: auto;
  --dest-scale: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 50px;
  height: 50px;
}

.dest-core {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  position: relative;
  z-index: 3;
  border: 3px solid rgba(255, 255, 255, 0.75);
  pointer-events: none;
  transition: transform 0.2s ease;
}

/* Inner dot for bullseye effect */
.dest-core::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 0 4px rgba(255, 255, 255, 0.6);
}

/* Crosshair lines */
.dest-crosshair {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}
.dest-crosshair-h, .dest-crosshair-v {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}
.dest-crosshair-h {
  width: 36px;
  height: 2px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0.5;
}
.dest-crosshair-v {
  width: 2px;
  height: 36px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0.5;
}

.dest-pulse-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 60px;
  height: 60px;
  margin: -30px 0 0 -30px;
  border-radius: 50%;
  border: 2.5px solid rgba(244, 63, 94, 0.5);
  background: rgba(244, 63, 94, 0.04);
  animation: destPulse 2.8s ease-out infinite;
  z-index: 1;
  pointer-events: none;
}

.dest-pulse-ring.delay {
  animation-delay: 1.4s;
}

.dest-label {
  position: absolute;
  top: calc(100% + 4px);
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  color: #f5ede0;
  font-weight: 600;
  letter-spacing: 0.02em;
  z-index: 4;
  text-shadow: 0 1px 4px rgba(0,0,0,0.9);
  pointer-events: none;
  white-space: nowrap;
  background: rgba(10, 8, 6, 0.9);
  padding: 3px 10px;
  border-radius: 4px;
  border: 1px solid rgba(244, 63, 94, 0.35);
}

.destination-marker.selected .dest-core {
  border-color: #fff;
  transform: scale(1.1);
}

.destination-marker:hover .dest-core {
  transform: scale(1.12);
  transition: transform 0.2s ease;
}

.destination-marker:hover .dest-crosshair-h,
.destination-marker:hover .dest-crosshair-v {
  opacity: 0.8;
}

@keyframes destPulse {
  0% {
    transform: scale(0.3);
    opacity: 0.9;
  }
  80% {
    opacity: 0;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

/* Pin drop animation */
.map-pin.pin-drop-anim {
  animation: pinDropBounce 0.5s ease-out;
}
@keyframes pinDropBounce {
  0% { opacity: 0; transform: translate(-50%, -150%) scale(var(--pin-scale, 1)); }
  50% { opacity: 1; transform: translate(-50%, -40%) scale(var(--pin-scale, 1)); }
  70% { transform: translate(-50%, -55%) scale(var(--pin-scale, 1)); }
  100% { transform: translate(-50%, -50%) scale(var(--pin-scale, 1)); }
}

/* --- PATCH: card content scaling --- */
.card .card-content img,
.card .card-content canvas,
.card .card-content svg {
  max-width: 100%;
  height: auto;
}
.card .card-content canvas {
  width: 100%;
  height: auto;
  display: block;
}

/* --- PATCH: image title appears on top --- */
.card.image-card .image-title {
  order: -1;
  margin-bottom: 8px;
}

/* --- PATCH: swatch layout safety (prevents color squares overlapping text) --- */
.search-result-item,
.association-item,
.connection-item {
  display: flex;
  align-items: center;
  gap: 10px;
}

.search-result-color,
.association-icon,
.connection-color {
  flex: 0 0 12px;
}

.search-result-name,
.association-name,
.connection-text {
  flex: 1 1 auto;
  min-width: 0;
}

/* Quick card toolbar (appears near zoom controls) */
.quick-card-toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  margin-right: 10px;
  border: 1px solid rgba(212, 168, 36, 0.25);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(8px);
}
.quick-card-toolbar .quick-label {
  font-size: 11px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(245, 237, 224, 0.75);
}
.quick-card-toolbar .quick-color {
  width: 28px;
  height: 18px;
  border: none;
  background: transparent;
  padding: 0;
}

/* Body map image silhouette */
.body-map {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 6px;
  overflow: visible;
  cursor: crosshair;
}
.body-map-inner {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
.body-silhouette-img {
  display: block;
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  user-select: none;
  pointer-events: none;
}

/* === PATCH: remove quick-card-toolbar entirely === */
.quick-card-toolbar {
  display: none !important;
}

/* === PATCH: Injury card note inputs === */
.injury-note {
  width: 100%;
  margin: 6px 0 10px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(212, 168, 36, 0.18);
  background: rgba(255, 255, 255, 0.03);
  color: var(--text, #e6dfd0);
  font-size: 12px;
}

/* Allow injury cards to stretch */
.card.injury .card-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}
.card.injury .injury-tracks {
  flex: 1;
  min-height: 0;
  overflow: auto;
  padding-right: 2px;
}

/* === PATCH: Bar card vertical resize === */
.card.bar .card-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}
.card.bar .card-bars {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  gap: 8px;
  overflow: auto;
  padding: 4px 0;
}
.card.bar .card-bar-item {
  flex: 1;
  min-height: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.card-bar {
  flex: 1;
  min-height: 14px;
  height: auto;
} /* allows bars to expand with card height */

/* === PATCH: Body map resizes + overlay tint === */
.card.body .card-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}
.body-map {
  flex: 1;
  min-height: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: crosshair;
}
.body-map-inner {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.body-silhouette-img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
  user-select: none;
}
.body-overlay {
  position: absolute;
  inset: 0;
  border-radius: 14px;
  pointer-events: none;
  mix-blend-mode: screen;
}
.body-point {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.3);
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.8), 0 0 16px currentColor, 0 0 8px currentColor;
}

.body-figure {
  position: relative;
  display: inline-block;
  max-width: 100%;
  max-height: 100%;
}
.body-figure .body-overlay {
  inset: 0;
}

/* ============================================
   Toolbar Card Title Input
   ============================================ */
.toolbar-input {
  padding: 5px 10px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(212, 168, 36, 0.25);
  border-radius: 4px;
  color: var(--text-primary, #f5ede0);
  font-size: 12px;
  font-family: inherit;
  min-width: 140px;
  max-width: 200px;
  transition: all 0.15s ease;
}
.toolbar-input:hover {
  background: rgba(0, 0, 0, 0.4);
  border-color: rgba(212, 168, 36, 0.4);
}
.toolbar-input:focus {
  outline: none;
  border-color: var(--gold, #d4a824);
  box-shadow: 0 0 0 2px rgba(212, 168, 36, 0.1);
}
.toolbar-input::placeholder {
  color: var(--text-muted, #665e50);
}

/* ============================================
   Multi-Select & Marquee
   ============================================ */
.card.multi-selected {
  outline: 2px solid var(--gold, #d4a824) !important;
  outline-offset: 2px;
  box-shadow: 0 0 20px rgba(212, 168, 36, 0.3), 0 0 6px rgba(212, 168, 36, 0.2) !important;
}

.marquee-rect {
  position: absolute;
  border: 2px dashed rgba(212, 168, 36, 0.6);
  background: rgba(212, 168, 36, 0.08);
  pointer-events: none;
  z-index: 9999;
  display: none;
  border-radius: 2px;
}

/* ============================================
   Dice Roll Badge
   ============================================ */
.dice-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  background: linear-gradient(135deg, rgba(212, 168, 36, 0.15), rgba(212, 168, 36, 0.08));
  border: 1px solid rgba(212, 168, 36, 0.35);
  border-radius: 12px;
  font-size: 0.85em;
  vertical-align: baseline;
  cursor: default;
  user-select: none;
}
.dice-badge .dice-icon {
  font-size: 0.9em;
}
.dice-badge .dice-formula {
  color: var(--text-muted, #665e50);
  font-size: 0.85em;
}
.dice-badge .dice-value {
  font-weight: 700;
  color: var(--gold, #d4a824);
  font-size: 1.05em;
  text-shadow: 0 0 6px rgba(212, 168, 36, 0.3);
}


/* ============================================
   Timeline View
   ============================================ */
.timeline-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--bg-darkest);
}

.tl-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  background: linear-gradient(180deg, #1a1816 0%, #131110 100%);
  border-bottom: 1px solid rgba(212, 168, 36, 0.25);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(245, 237, 224, 0.04);
  gap: 12px;
  flex-wrap: wrap;
}

.tl-header-info { display: flex; align-items: center; gap: 10px; }
.tl-header-controls { display: flex; align-items: center; gap: 10px; }

.tl-name-input {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-primary);
  font-size: 15px;
  font-weight: 600;
  font-family: 'Cinzel', serif;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  transition: var(--transition-fast);
  max-width: 240px;
}
.tl-name-input:focus { outline: none; border-color: var(--gold); background: rgba(0,0,0,0.3); }

.tl-calendar-badge {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--gold);
  background: rgba(212, 168, 36, 0.1);
  border: 1px solid rgba(212, 168, 36, 0.25);
  padding: 3px 10px;
  border-radius: 20px;
  font-weight: 600;
  white-space: nowrap;
}

.tl-view-modes {
  display: flex;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  overflow: hidden;
}
.tl-mode-btn {
  width: 32px; height: 28px;
  display: flex; align-items: center; justify-content: center;
  background: transparent; border: none; color: var(--text-muted);
  cursor: pointer; transition: var(--transition-fast);
}
.tl-mode-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.tl-mode-btn.active { background: rgba(212, 168, 36, 0.15); color: var(--gold); }

.tl-zoom-controls {
  display: flex; align-items: center; gap: 4px;
}
.tl-zoom-label {
  font-size: 10px; color: var(--text-muted); min-width: 36px; text-align: center;
}

.tl-body { flex: 1; overflow: hidden; position: relative; }

.tl-empty-state {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  height: 100%; gap: 16px; color: var(--text-muted); font-size: 14px;
}

/* ---- LANES VIEW (horizontal swim lanes) ---- */
.tl-lanes-view {
  height: 100%; overflow: hidden; display: flex; flex-direction: column;
}
.tl-lanes-scroll {
  flex: 1; overflow: auto; position: relative;
  scrollbar-width: thin; scrollbar-color: rgba(212,168,36,0.2) transparent;
  cursor: grab;
}
.tl-lanes-scroll:active { cursor: grabbing; }
.tl-lanes-scroll.panning { cursor: grabbing; user-select: none; }

/* Ruler along the top */
.tl-ruler {
  position: sticky; top: 0; z-index: 5;
  display: flex; height: 32px; min-width: max-content;
  background: linear-gradient(180deg, #141210 0%, #0e0d0c 100%);
  border-bottom: 1px solid rgba(212, 168, 36, 0.2);
}
.tl-ruler-segment {
  display: flex; align-items: center; justify-content: center;
  border-right: 1px solid rgba(212, 168, 36, 0.1);
  font-size: 10px; font-weight: 600; color: var(--text-muted);
  font-family: 'Cinzel', serif; letter-spacing: 0.04em;
  white-space: nowrap; box-sizing: border-box; padding: 0 8px;
  position: relative;
}
.tl-ruler-segment.year-start {
  color: var(--gold); border-left: 2px solid rgba(212, 168, 36, 0.4);
}
.tl-ruler-segment.festival { color: #f97316; font-style: italic; font-size: 9px; }

/* Swim Lanes */
.tl-lanes { min-width: max-content; position: relative; }

.tl-lane {
  display: flex; align-items: stretch;
  border-bottom: 1px solid rgba(212, 168, 36, 0.08);
  min-height: 64px; position: relative;
}
.tl-lane:hover { background: rgba(212, 168, 36, 0.02); }

.tl-lane-label {
  position: sticky; left: 0; z-index: 4;
  width: 140px; min-width: 140px; flex-shrink: 0;
  display: flex; flex-direction: column; justify-content: center;
  padding: 8px 12px; gap: 2px;
  background: linear-gradient(90deg, #0e0d0c 85%, transparent);
  border-right: 1px solid rgba(212, 168, 36, 0.12);
}
.tl-lane-name {
  font-size: 12px; font-weight: 600; color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.tl-lane-cal {
  font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;
}
.tl-lane-color {
  width: 4px; height: 100%; position: absolute; left: 0; top: 0;
  border-radius: 0 2px 2px 0;
}

.tl-lane-track {
  flex: 1; position: relative; min-height: 48px; padding: 6px 0;
}

/* Event markers on lane */
.tl-lane-event {
  position: absolute; top: 6px; bottom: 6px;
  min-width: 10px; border-radius: 4px; cursor: pointer;
  display: flex; align-items: center; padding: 0 8px; gap: 4px;
  font-size: 11px; font-weight: 500; color: #fff;
  transition: var(--transition-fast); overflow: hidden;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  border: 1px solid rgba(255,255,255,0.1);
}
.tl-lane-event:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  z-index: 3;
}
.tl-lane-event.selected {
  outline: 2px solid var(--gold);
  outline-offset: 1px;
  z-index: 4;
}
.tl-lane-event-title {
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* Vertical "now" line */
.tl-now-line {
  position: absolute; top: 0; bottom: 0;
  width: 2px; background: var(--gold);
  z-index: 3; opacity: 0.6;
  box-shadow: 0 0 6px rgba(212,168,36,0.3);
}
.tl-now-line::before {
  content: 'NOW'; position: absolute; top: -16px; left: 50%;
  transform: translateX(-50%); font-size: 8px; font-weight: 700;
  color: var(--gold); letter-spacing: 0.1em;
}

/* ---- LIST VIEW (vertical event list) ---- */
.tl-list-view { height: 100%; overflow: hidden; }

.tl-no-events {
  text-align: center; color: var(--text-muted); padding: 48px 24px; font-size: 14px;
}

.tl-list-scroll {
  height: 100%; overflow-y: auto; padding: 24px;
  scrollbar-width: thin; scrollbar-color: rgba(212,168,36,0.2) transparent;
  max-width: 720px; margin: 0 auto;
}

.tl-list-month {
  display: flex; align-items: center; gap: 12px;
  margin: 24px 0 16px; position: relative;
}
.tl-list-month:first-child { margin-top: 0; }
.tl-list-month-line { flex: 1; height: 1px; background: rgba(212, 168, 36, 0.15); }
.tl-list-month-label {
  background: rgba(10, 8, 6, 0.95);
  border: 1px solid rgba(212, 168, 36, 0.2);
  border-radius: 20px; padding: 4px 14px;
  font-family: 'Cinzel', serif; font-size: 11px; font-weight: 600;
  color: var(--gold); letter-spacing: 0.04em; white-space: nowrap;
}
.tl-list-month-year { font-size: 10px; color: var(--text-muted); font-weight: 400; margin-left: 4px; }

.tl-list-event {
  position: relative; margin-bottom: 16px; padding-left: 28px;
}
.tl-list-event::before {
  content: ''; position: absolute; left: 8px; top: 0; bottom: -16px;
  width: 2px; background: rgba(212, 168, 36, 0.15);
}
.tl-list-event:last-child::before { display: none; }
.tl-list-node {
  position: absolute; left: 2px; top: 12px;
  width: 14px; height: 14px; border-radius: 50%;
  border: 2.5px solid var(--bg-darkest); z-index: 2;
}
.tl-list-event.current .tl-list-node {
  box-shadow: 0 0 0 3px rgba(212,168,36,0.3);
}
.tl-list-event.past { opacity: 0.55; }
.tl-list-event.past:hover { opacity: 0.85; }

.tl-list-card {
  background: linear-gradient(135deg, rgba(26, 24, 22, 0.95) 0%, rgba(19, 17, 16, 0.9) 100%);
  border: 1px solid rgba(212, 168, 36, 0.12);
  border-left: 3px solid; border-radius: 0 var(--radius-md) var(--radius-md) 0;
  padding: 14px 18px; cursor: pointer; transition: var(--transition-fast);
}
.tl-list-card:hover {
  border-color: rgba(212, 168, 36, 0.3);
  transform: translateX(2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}
.tl-list-card.selected {
  border-color: rgba(212, 168, 36, 0.5);
  background: linear-gradient(135deg, rgba(30, 28, 26, 0.98) 0%, rgba(24, 22, 20, 0.95) 100%);
}
.tl-list-date { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }
.tl-list-title { font-size: 14px; font-weight: 600; color: var(--text-primary); line-height: 1.3; }
.tl-list-desc {
  font-size: 12px; color: var(--text-muted); margin-top: 6px;
  line-height: 1.5; white-space: pre-wrap;
}
.tl-list-era {
  font-size: 10px; color: var(--gold); margin-top: 6px;
  padding: 2px 8px; background: rgba(212,168,36,0.08); border-radius: 10px;
  display: inline-block;
}
.tl-list-tl-badge {
  font-size: 9px; color: var(--text-muted); margin-top: 6px;
  opacity: 0.7;
}

/* ---- Calendar Panel (right sidebar) ---- */
.tl-calendar-panel { padding: 0 4px; }

.tl-cal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0; margin-bottom: 4px;
}
.tl-cal-title {
  font-family: 'Cinzel', serif; font-size: 12px; font-weight: 600;
  color: var(--text-primary); text-align: center; flex: 1;
}

.tl-cal-grid {
  display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;
  margin-bottom: 10px;
}
.tl-cal-weekday {
  font-size: 8px; text-transform: uppercase; color: var(--text-muted);
  text-align: center; padding: 2px 0; font-weight: 600; letter-spacing: 0.05em;
}
.tl-cal-day {
  aspect-ratio: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  font-size: 11px; color: var(--text-secondary);
  border-radius: 4px; cursor: pointer; position: relative;
  transition: var(--transition-fast); border: 1px solid transparent;
}
.tl-cal-day:hover { background: var(--bg-hover); }
.tl-cal-day.today {
  border-color: var(--gold);
  color: var(--gold); font-weight: 700;
  background: rgba(212, 168, 36, 0.08);
}
.tl-cal-day.selected {
  background: rgba(212, 168, 36, 0.15);
  border-color: rgba(212, 168, 36, 0.4);
}
.tl-cal-day.has-event { font-weight: 600; }
.tl-cal-dot {
  width: 5px; height: 5px; border-radius: 50%;
  position: absolute; bottom: 3px;
}
.tl-cal-dot.multi { width: 8px; border-radius: 3px; }
.tl-cal-day.empty { cursor: default; }

.tl-cal-moon {
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  padding: 8px 0; border-top: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color); margin-bottom: 8px;
}
.tl-moon-row {
  display: flex; align-items: center; gap: 5px;
  font-size: 10px; color: var(--text-muted);
}

.tl-cal-event-list { display: flex; flex-direction: column; gap: 6px; margin-top: 6px; }

.tl-cal-evt-item {
  padding: 8px 10px; border-radius: var(--radius-sm);
  border-left: 3px solid; cursor: pointer;
  background: var(--bg-card); transition: var(--transition-fast);
}
.tl-cal-evt-item:hover { background: var(--bg-hover); }
.tl-cal-evt-item.selected { background: rgba(212, 168, 36, 0.08); }
.tl-cal-evt-item-title { font-size: 12px; font-weight: 600; color: var(--text-primary); }
.tl-cal-evt-item-desc {
  font-size: 11px; color: var(--text-muted); margin-top: 3px;
  line-height: 1.4; white-space: pre-wrap;
}

/* Event detail in panel */
.tl-event-detail { padding-top: 12px; border-top: 1px solid var(--border-color); }
.tl-evt-color-bar { width: 100%; height: 4px; border-radius: 2px; margin-bottom: 10px; }
.tl-evt-title { font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
.tl-evt-date-label { font-size: 10px; color: var(--gold); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 8px; }
.tl-evt-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.6; white-space: pre-wrap; }
.tl-evt-era {
  font-size: 10px; color: var(--gold); margin-top: 8px;
  padding: 2px 8px; background: rgba(212,168,36,0.08);
  border-radius: 10px; display: inline-block;
}
.tl-evt-era:empty { display: none; }

/* Sidebar items */
.sidebar-item {
  display: flex; flex-direction: column; gap: 2px;
  padding: 8px 12px; border-radius: var(--radius-sm);
  cursor: pointer; transition: var(--transition-fast);
  border: 1px solid transparent;
}
.sidebar-item:hover { background: var(--bg-hover); }
.sidebar-item.active {
  background: rgba(212, 168, 36, 0.08);
  border-color: rgba(212, 168, 36, 0.2);
}
.sidebar-item-name {
  font-size: 13px; font-weight: 500; color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.sidebar-item-sub { font-size: 10px; color: var(--text-muted); }

/* Sidebar date display */
.timeline-date-display { padding: 8px 0; }
.tl-date-main { font-size: 12px; color: var(--text-primary); font-weight: 500; line-height: 1.4; padding: 4px 0 8px; }
.tl-moon-display { display: flex; flex-direction: column; gap: 4px; }
.tl-date-controls {
  display: flex; gap: 4px; margin-top: 10px; padding-top: 10px;
  border-top: 1px solid var(--border-color);
}
.tl-date-controls .btn.sm { font-size: 10px; padding: 4px 8px; flex: 1; }

/* Toggle switch */
.popup-toggle-row {
  display: flex; align-items: center; justify-content: space-between;
  margin: 8px 0;
}
.tl-toggle {
  position: relative; width: 36px; height: 20px; cursor: pointer;
}
.tl-toggle input { display: none; }
.tl-toggle-slider {
  position: absolute; inset: 0; background: var(--bg-lighter);
  border-radius: 20px; transition: 0.2s;
}
.tl-toggle-slider::before {
  content: ''; position: absolute; left: 2px; top: 2px;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--text-muted); transition: 0.2s;
}
.tl-toggle input:checked + .tl-toggle-slider { background: rgba(212,168,36,0.3); }
.tl-toggle input:checked + .tl-toggle-slider::before {
  transform: translateX(16px); background: var(--gold);
}

/* Context Menu */
.tl-context-menu {
  position: fixed; z-index: 1000;
  background: linear-gradient(180deg, #1e1c1a, #161412);
  border: 1px solid rgba(212, 168, 36, 0.25);
  border-radius: var(--radius-md);
  padding: 4px; min-width: 180px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}
.tl-context-menu.hidden { display: none; }
.tl-ctx-item {
  display: flex; align-items: center; gap: 8px;
  width: 100%; padding: 7px 12px; border: none; background: transparent;
  color: var(--text-secondary); font-size: 12px; cursor: pointer;
  border-radius: var(--radius-sm); text-align: left;
  transition: var(--transition-fast);
}
.tl-ctx-item:hover { background: var(--bg-hover); color: var(--text-primary); }
.tl-ctx-item.danger:hover { background: rgba(244,63,94,0.15); color: #f43f5e; }
.tl-ctx-divider { height: 1px; background: var(--border-color); margin: 4px 8px; }

/* Calendar months editor */
.cal-months-editor { display: flex; flex-direction: column; gap: 6px; }
.cal-month-row {
  display: flex; align-items: center; gap: 6px;
}
.cal-month-row input { flex: 1; }
.cal-month-row .popup-input { margin: 0; }
.cal-month-days { width: 60px !important; flex: none !important; }
.cal-month-remove {
  width: 24px; height: 24px; border: none; background: transparent;
  color: var(--text-muted); cursor: pointer; font-size: 14px;
  border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;
}
.cal-month-remove:hover { color: #f43f5e; background: rgba(244,63,94,0.1); }
.cal-month-festival {
  width: 24px; height: 24px; border: 1px solid var(--border-color);
  background: transparent; color: var(--text-muted); cursor: pointer;
  font-size: 12px; border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
}
.cal-month-festival.active { color: var(--gold); border-color: var(--gold); background: rgba(212,168,36,0.1); }

/* Large popup modal */
.popup-modal.lg { max-width: 540px; }

/* Timeline lane with image */
.tl-lane-image {
  position: absolute; inset: 0; opacity: 0.15;
  background-size: cover; background-position: center;
  pointer-events: none;
}

/* Event tags in list view */
.tl-list-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
.tl-list-tag {
  font-size: 9px; padding: 2px 6px; border-radius: 8px;
  background: var(--bg-lighter); color: var(--text-muted);
}

/* Event detail tags in panel */
.tl-evt-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }

/* Read more button in list view */
.tl-read-more {
  background: none; border: none; color: var(--gold); cursor: pointer;
  font-size: 11px; padding: 0; margin-left: 4px; text-decoration: underline;
  opacity: 0.8; transition: opacity 0.15s;
}
.tl-read-more:hover { opacity: 1; }
.tl-desc-truncated, .tl-desc-full { white-space: pre-wrap; }
.tl-desc-full { display: inline; }
.tl-desc-full.hidden { display: none; }
.tl-desc-truncated.hidden { display: none; }

/* Moon phase on calendar days */
.tl-cal-day-moon {
  position: absolute; top: 1px; right: 2px;
  font-size: 8px; line-height: 1; opacity: 0.7;
  pointer-events: none;
}
.tl-cal-day { position: relative; }

/* Moon icon in panel */
.tl-moon-icon { font-size: 16px; }

/* ---- Moon Editor ---- */
.cal-moons-editor { display: flex; flex-direction: column; gap: 6px; }
.cal-moon-row {
  display: flex; align-items: center; gap: 6px;
}
.cal-moon-row input { flex: 1; }
.cal-moon-row .popup-input { margin: 0; }
.cal-moon-cycle-input { width: 60px !important; flex: none !important; }
.cal-moon-color { width: 28px !important; height: 28px !important; min-width: 28px; min-height: 28px; max-width: 28px; max-height: 28px; border: none; border-radius: 50% !important; cursor: pointer; padding: 0 !important; background: transparent; flex-shrink: 0; flex-grow: 0; appearance: none; -webkit-appearance: none; -moz-appearance: none; overflow: hidden; box-sizing: border-box; }
.cal-moon-color::-webkit-color-swatch-wrapper { padding: 0; border-radius: 50%; }
.cal-moon-color::-webkit-color-swatch { border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; }
.cal-moon-color::-moz-color-swatch { border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; }

/* Moon legend in calendar panel */
.tl-moon-legend { display: flex; flex-wrap: wrap; gap: 8px; padding: 8px 0; }
.tl-moon-legend-item {
  display: flex; align-items: center; gap: 5px; font-size: 10px; color: var(--text-secondary);
}
.tl-moon-dot {
  width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0;
  box-shadow: 0 0 6px rgba(255,255,255,0.2);
}
.tl-moon-phase-icon {
  font-size: 14px; filter: none; display: inline-block;
}
.tl-cal-day-moon {
  position: absolute; top: 0px; right: 1px;
  width: 5px; height: 5px; border-radius: 50%;
  pointer-events: none; opacity: 0.9;
}


/* ============================================
   Combat Tracker - Full Page View
   ============================================ */
.combat-container {
  flex: 1; display: flex; flex-direction: column;
  background: var(--bg-primary); overflow: hidden;
}

.ct-view-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 20px; border-bottom: 1px solid rgba(244,63,94,0.15);
  background: linear-gradient(180deg, rgba(244,63,94,0.04) 0%, transparent 100%);
}
.ct-view-header-left { display: flex; align-items: center; gap: 12px; }
.ct-view-title { font-size: 16px; font-weight: 700; color: var(--text-primary); margin: 0; }
.ct-round-badge {
  font-size: 11px; font-weight: 600; padding: 3px 10px;
  border-radius: 12px; background: rgba(244,63,94,0.12); color: #f43f5e;
  letter-spacing: 0.3px;
}
.ct-view-header-right { display: flex; align-items: center; gap: 6px; }

.ct-btn {
  padding: 5px 10px; border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius-sm); background: var(--bg-card);
  color: var(--text-secondary); font-size: 11px; cursor: pointer;
  transition: var(--transition-fast); white-space: nowrap;
}
.ct-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.ct-btn.sm { padding: 3px 8px; font-size: 10px; }
.ct-btn.primary { background: rgba(244,63,94,0.15); color: #f43f5e; border-color: rgba(244,63,94,0.25); }
.ct-btn.primary:hover { background: rgba(244,63,94,0.3); }

.ct-view-body { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

/* Turn Bar */
.ct-turn-bar {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 16px; background: var(--bg-card);
  border-bottom: 1px solid var(--border-color);
}
.ct-turn-nav {
  padding: 6px 14px; border: 1px solid rgba(244,63,94,0.2);
  border-radius: var(--radius-sm); background: rgba(244,63,94,0.08);
  color: #f43f5e; font-size: 12px; font-weight: 600; cursor: pointer;
  transition: var(--transition-fast); white-space: nowrap;
}
.ct-turn-nav:hover { background: rgba(244,63,94,0.2); }
.ct-turn-current {
  flex: 1; display: flex; align-items: center; gap: 10px;
  padding: 4px 0;
}
.ct-turn-label { font-size: 12px; color: var(--text-muted); }
.ct-turn-init-badge {
  width: 30px; height: 30px; border-radius: 50%; display: flex;
  align-items: center; justify-content: center; font-size: 13px;
  font-weight: 700; color: var(--text-primary); background: var(--bg-lighter);
  border: 2px solid; flex-shrink: 0;
}
.ct-turn-info { flex: 1; }
.ct-turn-name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
.ct-turn-hp-mini {
  width: 100%; height: 3px; background: rgba(255,255,255,0.06);
  border-radius: 2px; margin-top: 3px; overflow: hidden;
}
.ct-turn-hp-fill { height: 100%; border-radius: 2px; transition: width 0.3s; }
.ct-turn-round { font-size: 10px; color: #f43f5e; font-weight: 600; white-space: nowrap; }

/* Main Grid: combatants + detail */
.ct-main-grid {
  flex: 1; display: flex; overflow: hidden;
}
.ct-combatants-col {
  flex: 1; overflow-y: auto; padding: 8px;
  scrollbar-width: thin; scrollbar-color: rgba(244,63,94,0.1) transparent;
}
.ct-detail-col {
  width: 320px; border-left: 1px solid var(--border-color);
  overflow-y: auto; scrollbar-width: thin;
}

/* Combatant List */
.ct-combatants { display: flex; flex-direction: column; gap: 3px; }
.ct-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); font-size: 13px; }

.ct-combatant {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 10px; border-radius: var(--radius-sm);
  background: var(--bg-card); border: 1px solid transparent;
  transition: var(--transition-fast); cursor: pointer; position: relative;
}
.ct-combatant:hover { background: var(--bg-hover); }
.ct-combatant.selected { border-color: var(--gold); background: rgba(212,168,36,0.04); }
.ct-combatant.active-turn {
  border-color: rgba(244,63,94,0.6);
  background: linear-gradient(90deg, rgba(244,63,94,0.1), rgba(244,63,94,0.03) 40%, rgba(244,63,94,0.06));
  box-shadow: inset 0 0 0 1px rgba(244,63,94,0.15), 0 0 12px rgba(244,63,94,0.2);
  animation: activeTurnPulse 2s ease-in-out infinite, activeTurnShimmer 3s ease-in-out infinite;
  position: relative;
  overflow: hidden;
}
.ct-combatant.active-turn::before {
  content: '';
  position: absolute;
  top: 0; left: -100%; width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(244,63,94,0.08), rgba(255,255,255,0.04), transparent);
  animation: turnSweep 2.5s ease-in-out infinite;
  pointer-events: none;
  z-index: 0;
}
.ct-combatant.active-turn > * { position: relative; z-index: 1; }
@keyframes activeTurnPulse {
  0%, 100% { box-shadow: inset 0 0 0 1px rgba(244,63,94,0.15), 0 0 10px rgba(244,63,94,0.15); }
  50% { box-shadow: inset 0 0 0 1px rgba(244,63,94,0.35), 0 0 24px rgba(244,63,94,0.3), 0 0 48px rgba(244,63,94,0.1); }
}
@keyframes activeTurnShimmer {
  0%, 100% { border-color: rgba(244,63,94,0.5); }
  33% { border-color: rgba(255,120,150,0.7); }
  66% { border-color: rgba(244,63,94,0.6); }
}
@keyframes turnSweep {
  0% { left: -100%; opacity: 0; }
  20% { opacity: 1; }
  80% { opacity: 1; }
  100% { left: 200%; opacity: 0; }
}
.ct-combatant.dead { opacity: 0.3; }

.ct-turn-indicator {
  width: 4px; height: 100%; position: absolute; left: 0; top: 0;
  border-radius: 3px 0 0 3px; background: transparent;
  transition: background 0.3s ease;
}
.ct-combatant.active-turn .ct-turn-indicator {
  width: 5px;
  background: linear-gradient(180deg, #ff6b8a, #f43f5e, #ff6b8a);
  animation: turnIndicatorGlow 1.5s ease-in-out infinite;
}
@keyframes turnIndicatorGlow {
  0%, 100% { box-shadow: 0 0 6px #f43f5e, 0 0 12px rgba(244,63,94,0.4); }
  50% { box-shadow: 0 0 10px #f43f5e, 0 0 24px rgba(244,63,94,0.6), 0 0 36px rgba(244,63,94,0.3); }
}

.ct-init-badge {
  width: 32px; height: 32px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 700; color: var(--text-primary);
  background: var(--bg-lighter); border: 2px solid var(--border-color);
  flex-shrink: 0; cursor: pointer; transition: var(--transition-fast);
}
.ct-init-badge:hover { border-color: var(--gold); }
.ct-combatant.active-turn .ct-init-badge { border-color: #f43f5e; color: #f43f5e; }

.ct-combatant-info { flex: 1; min-width: 0; }
.ct-combatant-name-row { display: flex; align-items: center; gap: 6px; }
.ct-combatant-name {
  font-size: 12px; font-weight: 600; color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.ct-ac-badge { font-size: 9px; color: var(--text-muted); background: var(--bg-lighter); padding: 1px 5px; border-radius: 6px; }
.ct-has-notes { font-size: 10px; opacity: 0.5; }
.ct-bd-badge { font-size: 8px; color: var(--text-muted); margin-left: 4px; }

.ct-hp-inline { display: flex; align-items: center; gap: 6px; margin-top: 3px; }
.ct-hp-track {
  flex: 1; height: 5px; background: rgba(255,255,255,0.06);
  border-radius: 3px; overflow: hidden;
}
.ct-hp-fill { height: 100%; border-radius: 3px; transition: width 0.3s, background 0.3s; }
.ct-hp-text { font-size: 9px; color: var(--text-muted); white-space: nowrap; min-width: 45px; }



.ct-combatant-actions {
  display: flex; gap: 2px; flex-shrink: 0; opacity: 0;
  transition: opacity 0.15s;
}
.ct-combatant:hover .ct-combatant-actions { opacity: 1; }

.ct-action-btn {
  width: 22px; height: 22px; border: none; border-radius: var(--radius-sm);
  background: transparent; color: var(--text-muted); cursor: pointer;
  display: flex; align-items: center; justify-content: center; font-size: 11px;
  transition: var(--transition-fast);
}
.ct-action-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.ct-action-btn.danger:hover { color: #f43f5e; background: rgba(244,63,94,0.1); }

/* Detail Panel */
.ct-detail-card { padding: 16px; display: flex; flex-direction: column; gap: 16px; }
.ct-detail-name { font-size: 16px; font-weight: 700; color: var(--text-primary); }
.ct-detail-ac { font-size: 11px; font-weight: 500; color: var(--text-muted); background: var(--bg-lighter); padding: 2px 8px; border-radius: 8px; margin-left: 6px; }
.ct-detail-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-muted); margin-bottom: 6px; display: block; }

.ct-harm-section { }
.ct-harm-bar-lg {
  width: 100%; height: 12px; background: rgba(255,255,255,0.06);
  border-radius: 6px; overflow: hidden; margin-bottom: 6px;
}
.ct-harm-fill-lg { height: 100%; border-radius: 6px; transition: width 0.3s, background 0.3s; }
.ct-harm-numbers { font-size: 14px; font-weight: 700; color: var(--text-primary); text-align: center; margin-bottom: 8px; }
.ct-harm-controls { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; }
.ct-harm-controls .ct-btn { min-width: 40px; text-align: center; }

.ct-conditions-section { }
.ct-conditions-grid { display: flex; flex-wrap: wrap; gap: 4px; }
.ct-cond-btn {
  font-size: 10px; padding: 3px 8px; border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.06); background: var(--bg-card);
  color: var(--text-muted); cursor: pointer; transition: var(--transition-fast);
  white-space: nowrap;
}
.ct-cond-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.ct-cond-btn.active { background: rgba(244,63,94,0.15); color: #f43f5e; border-color: rgba(244,63,94,0.25); }
.ct-cond-btn.buff.active { background: rgba(34,197,94,0.15); color: #22c55e; border-color: rgba(34,197,94,0.25); }

.ct-buffs-section { }
.ct-buffs-list { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 6px; }
.ct-buff-pill {
  display: flex; align-items: center; gap: 4px;
  font-size: 10px; padding: 2px 8px; border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.06);
}
.ct-buff-pill.buff { background: rgba(34,197,94,0.1); color: #22c55e; border-color: rgba(34,197,94,0.15); }
.ct-buff-pill.debuff { background: rgba(244,63,94,0.1); color: #f43f5e; border-color: rgba(244,63,94,0.15); }
.ct-buff-remove { cursor: pointer; opacity: 0.5; margin-left: 2px; }
.ct-buff-remove:hover { opacity: 1; }
.ct-buff-add { display: flex; gap: 4px; align-items: center; }

.ct-notes-section { }
.ct-notes-area {
  width: 100%; min-height: 80px; padding: 8px; border-radius: var(--radius-sm);
  border: 1px solid var(--border-color); background: var(--bg-card);
  color: var(--text-primary); font-size: 11px; font-family: inherit; resize: vertical;
}
.ct-notes-area:focus { border-color: rgba(244,63,94,0.3); outline: none; }

.ct-add-input {
  padding: 6px 8px; border-radius: var(--radius-sm);
  border: 1px solid rgba(255,255,255,0.08); background: var(--bg-card);
  color: var(--text-primary); font-size: 11px;
}
.ct-add-input.sm { width: 60px; text-align: center; }
.ct-add-input:focus { border-color: rgba(244,63,94,0.3); outline: none; }
.ct-add-input::placeholder { color: var(--text-muted); }


/* ============================================
   Factions & Contacts - Full Page View
   ============================================ */
.faction-container {
  flex: 1; display: flex; flex-direction: column;
  background: var(--bg-primary); overflow: hidden;
}

/* Sub-tabs header */
.fac-header {
  display: flex; align-items: center; justify-content: center;
  padding: 0 16px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-card);
}
.fac-sub-tabs { display: flex; gap: 4px; }
.fac-sub-tab {
  padding: 12px 28px; font-size: 14px; font-weight: 700;
  color: var(--text-muted); background: none; border: none;
  border-bottom: 3px solid transparent; cursor: pointer;
  transition: var(--transition-fast); letter-spacing: 0.3px;
}
.fac-sub-tab:hover { color: var(--text-primary); background: var(--bg-hover); }
.fac-sub-tab.active { color: var(--gold); border-bottom-color: var(--gold); }

/* Content area */
.fac-body {
  flex: 1; overflow-y: auto; padding: 16px;
  scrollbar-width: thin;
}

.fac-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
}
.fac-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); font-size: 13px; grid-column: 1/-1; }

/* Faction cards - compact, click to see detail */
.fac-card {
  background: var(--bg-card); border: 1px solid var(--border-color);
  border-radius: var(--radius-lg); overflow: hidden;
  transition: var(--transition-fast); cursor: pointer; position: relative;
  padding: 14px;
}
.fac-card:hover { border-color: rgba(255,255,255,0.1); background: var(--bg-hover); }
.fac-card.selected { border-color: var(--fac-color, var(--gold)); box-shadow: 0 0 12px rgba(139,92,246,0.08); }

.fac-card-header {
  display: flex; align-items: flex-start; gap: 10px; margin-bottom: 8px;
}
.fac-card-color {
  width: 10px; height: 10px; border-radius: 50%; margin-top: 4px;
  flex-shrink: 0; box-shadow: 0 0 8px var(--fac-color);
}
.fac-card-title { flex: 1; }
.fac-card-name { font-size: 15px; font-weight: 700; color: var(--text-primary); }
.fac-card-meta { display: flex; gap: 6px; margin-top: 3px; align-items: center; }
.fac-card-tier { font-size: 10px; color: var(--text-muted); background: var(--bg-lighter); padding: 1px 6px; border-radius: 6px; }
.fac-card-status { font-size: 10px; color: var(--text-secondary); }

/* Reputation on card */
.fac-rep-section { padding: 0 0 8px; }
.fac-label {
  font-size: 9px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.8px; color: var(--text-muted); margin-bottom: 4px; display: block;
}
.fac-rep-track { display: flex; gap: 4px; align-items: center; }
.fac-rep-pip {
  width: 20px; height: 8px; border-radius: 4px;
  background: rgba(255,255,255,0.06); cursor: pointer;
  transition: var(--transition-fast); border: 1px solid transparent;
}
.fac-rep-pip:hover { background: rgba(255,255,255,0.15); transform: scaleY(1.3); }
.fac-rep-pip.active { border-color: rgba(255,255,255,0.1); }
.fac-rep-label { font-size: 11px; font-weight: 600; margin-top: 2px; }

/* Card compact tags */
.fac-card-tags { display: flex; flex-wrap: wrap; gap: 3px; padding: 0 0 8px; }
.fac-tag-pill-sm {
  font-size: 10px; padding: 1px 6px; border-radius: 6px;
  background: rgba(59,130,246,0.08); color: #60a5fa;
}
.fac-tag-pill-sm.muted { background: var(--bg-lighter); color: var(--text-muted); }
.fac-assoc-pill-sm {
  font-size: 10px; padding: 1px 6px; border-radius: 6px;
  background: rgba(234,179,8,0.08); color: #fbbf24;
}
.fac-claim-sm {
  font-size: 10px; padding: 1px 6px; border-radius: 6px;
  background: rgba(139,92,246,0.08); color: #a78bfa;
}
.fac-card-pills { display: flex; flex-wrap: wrap; gap: 3px; padding: 0 0 8px; }
.fac-card-notes-indicator { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

/* Read more for descriptions */
.fac-card-desc {
  font-size: 11px; color: var(--text-secondary); line-height: 1.5; padding: 4px 0 4px;
  max-height: 3.3em; overflow: hidden; position: relative;
  transition: max-height 0.3s ease;
}
.fac-card-desc.expanded { max-height: 1000px; }
.fac-contact-card-notes {
  font-size: 11px; color: var(--text-muted); line-height: 1.4;
  padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.04); margin-top: 4px;
  max-height: 2.8em; overflow: hidden; position: relative;
  transition: max-height 0.3s ease;
}
.fac-contact-card-notes.expanded { max-height: 1000px; }
.fac-read-more {
  background: none; border: none; color: var(--gold); cursor: pointer;
  font-size: 10px; padding: 2px 0; font-weight: 600;
  transition: var(--transition-fast);
}
.fac-read-more:hover { text-decoration: underline; }

/* Contact type badge */
.fac-type-badge {
  font-size: 9px; padding: 1px 6px; border-radius: 6px; font-weight: 600;
  background: rgba(139,92,246,0.1); color: #a78bfa; white-space: nowrap;
}
.fac-contact-card-type {
  font-size: 10px; color: #fbbf24; background: rgba(234,179,8,0.1);
  padding: 1px 8px; border-radius: 6px; display: inline-block; margin-bottom: 4px;
}

/* Connections on card */
.fac-card-connections { padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.04); }
.fac-contact-row {
  display: flex; align-items: center; gap: 6px;
  padding: 3px 0; font-size: 11px;
}
.fac-contact-name { flex: 1; color: var(--text-primary); font-weight: 500; }
.fac-contact-role { color: var(--text-muted); font-size: 10px; }
.fac-contact-disp {
  font-size: 9px; padding: 1px 6px; border-radius: 6px; font-weight: 600;
}
.fac-contact-disp.friendly { background: rgba(34,197,94,0.12); color: #22c55e; }
.fac-contact-disp.neutral { background: rgba(107,114,128,0.12); color: #9ca3af; }
.fac-contact-disp.hostile { background: rgba(244,63,94,0.12); color: #f43f5e; }
.fac-contact-disp.allied { background: rgba(59,130,246,0.12); color: #60a5fa; }
.fac-contact-disp.suspicious { background: rgba(249,115,22,0.12); color: #f97316; }

/* Right detail panel */
/* Faction detail color bar */
.fac-detail-color-bar {
  height: 4px; border-radius: 2px; margin-bottom: 10px;
}

/* Faction / Contact detail images */
.fac-detail-image-wrap {
  width: 100%; aspect-ratio: 16/9; border-radius: var(--radius-sm);
  background: var(--bg-lighter); display: flex; align-items: center;
  justify-content: center; overflow: hidden; border: 1px solid var(--border-color);
}
.fac-detail-no-image { font-size: 11px; color: var(--text-muted); }
.fac-detail-img { width: 100%; height: 100%; object-fit: cover; display: block; }

/* Card icon thumbnails */
.fac-card-icon {
  width: 40px; height: 40px; border-radius: var(--radius-sm);
  object-fit: cover; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.08);
}
.con-card-icon {
  width: 36px; height: 36px; border-radius: 50%;
  object-fit: cover; flex-shrink: 0; margin-right: 8px;
  border: 1px solid rgba(255,255,255,0.08);
}

/* Detail panel tag displays */
.fac-assoc-display { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 4px; }
.fac-tag-pill {
  display: inline-flex; align-items: center; gap: 3px;
  font-size: 11px; padding: 2px 8px; border-radius: 8px;
  background: rgba(59,130,246,0.12); color: #60a5fa;
  border: 1px solid rgba(59,130,246,0.15);
}
.fac-tag-remove { cursor: pointer; opacity: 0.5; font-size: 10px; margin-left: 2px; }
.fac-tag-remove:hover { opacity: 1; }
.fac-assoc-pill {
  display: inline-flex; align-items: center; gap: 3px;
  font-size: 11px; padding: 2px 8px; border-radius: 8px;
  background: rgba(234,179,8,0.12); color: #fbbf24;
  border: 1px solid rgba(234,179,8,0.15);
}
.fac-assoc-remove { cursor: pointer; opacity: 0.5; font-size: 10px; margin-left: 2px; }
.fac-assoc-remove:hover { opacity: 1; }

/* Claims */
.fac-claims-list { display: flex; flex-wrap: wrap; gap: 4px; }
.fac-claim {
  display: inline-flex; align-items: center; gap: 3px;
  font-size: 10px; padding: 2px 8px; border-radius: 8px;
  background: rgba(139,92,246,0.1); color: #a78bfa;
  border: 1px solid rgba(139,92,246,0.15);
}
.fac-claim-x { cursor: pointer; opacity: 0.5; font-size: 10px; }
.fac-claim-x:hover { opacity: 1; }

/* ---- Contacts Tab ---- */
.fac-contacts-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 12px;
}

.fac-contact-card {
  background: var(--bg-card); border: 1px solid var(--border-color);
  border-radius: var(--radius-lg); padding: 14px; cursor: pointer;
  transition: var(--transition-fast); border-left: 3px solid var(--fac-color, #666);
}
.fac-contact-card:hover { border-color: rgba(255,255,255,0.1); background: var(--bg-hover); border-left-color: var(--fac-color, #666); }
.fac-contact-card.selected { border-color: var(--gold); box-shadow: 0 0 12px rgba(212,168,36,0.08); border-left-color: var(--fac-color, var(--gold)); }

.fac-contact-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; }
.fac-contact-card-name { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.fac-contact-card-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
.fac-contact-card-role { font-size: 11px; color: var(--text-secondary); }
.fac-contact-card-faction { font-size: 11px; }

/* Faction color picker in create modal */

/* Randomizer Card */
.randomizer-card-content { padding: 4px 0; }
.rand-table { display: flex; flex-direction: column; gap: 1px; margin-bottom: 8px; }
.rand-entry {
  display: flex; align-items: center; gap: 6px; padding: 4px 8px;
  border-radius: var(--radius-sm); font-size: 11px;
  background: rgba(255,255,255,0.02); transition: all 0.15s ease;
}
.rand-entry.active {
  background: rgba(232,121,168,0.15); font-weight: 700;
  box-shadow: inset 0 0 0 1px rgba(232,121,168,0.3);
  animation: rand-flash 0.3s ease;
}
@keyframes rand-flash {
  0% { background: rgba(232,121,168,0.4); }
  100% { background: rgba(232,121,168,0.15); }
}
.rand-entry-num {
  font-size: 9px; font-weight: 700; opacity: 0.4;
  min-width: 16px; text-align: right;
}
.rand-entry-text { flex: 1; }
.rand-roll-area { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.rand-roll-btn {
  background: rgba(232,121,168,0.15); border: 1px solid rgba(232,121,168,0.3);
  color: #e879a8; padding: 6px 16px; border-radius: var(--radius-sm);
  font-size: 12px; font-weight: 700; cursor: pointer;
  transition: var(--transition-fast);
}
.rand-roll-btn:hover { background: rgba(232,121,168,0.25); transform: scale(1.02); }
.rand-result {
  font-size: 13px; font-weight: 700; margin-top: 2px;
  text-align: center; animation: rand-flash 0.3s ease;
}

/* Randomizer Detail Panel */
.rand-entry-row {
  display: flex; align-items: center; gap: 4px; margin-bottom: 3px;
}
.rand-entry-num-detail { font-size: 10px; color: var(--text-muted); min-width: 18px; }
.rand-roll-btn-detail {
  background: rgba(232,121,168,0.15); border: 1px solid rgba(232,121,168,0.3);
  color: #e879a8; padding: 8px 20px; border-radius: var(--radius-sm);
  font-size: 13px; font-weight: 700; cursor: pointer; width: 100%;
  transition: var(--transition-fast);
}
.rand-roll-btn-detail:hover { background: rgba(232,121,168,0.25); }
.rand-detail-result {
  font-size: 14px; font-weight: 700; color: var(--text-primary);
  margin-top: 6px; min-height: 20px; text-align: center;
}

/* Faction color picker in create modal */
.popup-color-row { display: flex; gap: 6px; flex-wrap: wrap; padding: 4px 0; }
.fac-color-btn {
  width: 28px; height: 28px; border-radius: 50%; border: 2px solid transparent;
  cursor: pointer; transition: var(--transition-fast);
}
.fac-color-btn:hover { transform: scale(1.15); }
.fac-color-btn.active { border-color: #fff; box-shadow: 0 0 8px rgba(255,255,255,0.3); }

/* Combat status tags - text only, bigger */
.ct-combatant-status { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 4px; }
.ct-status-tag {
  font-size: 11px; padding: 1px 7px; border-radius: 8px; font-weight: 500; line-height: 1.4;
}
.ct-status-tag.debuff { background: rgba(244,63,94,0.12); color: #f87171; }
.ct-status-tag.buff { background: rgba(34,197,94,0.12); color: #4ade80; }

/* Condition buttons - bigger text */
.ct-cond-btn {
  font-size: 12px; padding: 4px 10px; border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.06); background: var(--bg-card);
  color: var(--text-secondary); cursor: pointer; transition: var(--transition-fast);
  white-space: nowrap;
}
.ct-cond-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.ct-cond-btn.active { background: rgba(244,63,94,0.15); color: #f43f5e; border-color: rgba(244,63,94,0.25); font-weight: 600; }
.ct-cond-btn.buff.active { background: rgba(34,197,94,0.15); color: #22c55e; border-color: rgba(34,197,94,0.25); font-weight: 600; }

/* ============================================ */
/* Settings Modal */
/* ============================================ */
.settings-btn { color: var(--text-muted); transition: var(--transition-fast); }
.settings-btn:hover { color: var(--gold); }
.settings-checks { display: flex; flex-direction: column; gap: 2px; }
.settings-check-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 12px;
  border-radius: var(--radius-sm); cursor: pointer;
  transition: var(--transition-fast);
}
.settings-check-row:hover { background: var(--bg-hover); }
.settings-check-row input[type="checkbox"] {
  width: 16px; height: 16px; accent-color: var(--gold);
  cursor: pointer; flex-shrink: 0;
}
.settings-check-label { font-size: 13px; color: var(--text-primary); font-weight: 500; flex: 1; }
.settings-check-mark { color: var(--gold); font-size: 14px; font-weight: 700; }

/* ============================================ */
/* Hidden Items */
/* ============================================ */
.item-hidden { opacity: 0.4; }
.item-hidden:hover { opacity: 0.7; }
.card-hidden { opacity: 0.35; outline: 1px dashed rgba(255,255,255,0.15); }
.card-hidden:hover { opacity: 0.6; }
.ct-hidden { opacity: 0.4; }
.ct-hidden:hover { opacity: 0.7; }
.hidden-badge {
  font-size: 10px; opacity: 0.6; margin-right: 4px; flex-shrink: 0;
}
.hidden-badge-sm {
  font-size: 9px; position: absolute; top: 2px; right: 4px; opacity: 0.5;
}
.hidden-badge-card {
  font-size: 10px; position: absolute; top: 6px; right: 8px; opacity: 0.5; z-index: 1;
}
.fac-card, .fac-contact-card { position: relative; }

/* ============================================ */
/* Sidebar Delete Button */
/* ============================================ */
.sidebar-del-btn {
  position: absolute; top: 50%; right: 6px; transform: translateY(-50%);
  background: none; border: none; color: var(--text-muted); font-size: 14px;
  cursor: pointer; opacity: 0; transition: var(--transition-fast);
  width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm);
}
.sidebar-item:hover .sidebar-del-btn { opacity: 0.5; }
.sidebar-del-btn:hover { opacity: 1 !important; color: var(--rose); background: rgba(244,63,94,0.1); }

/* ============================================ */
/* Buff/Debuff Pills on Combatants */
/* ============================================ */
.ct-combatant-buffs {
  display: flex; flex-wrap: wrap; gap: 3px; margin-top: 3px;
}
.ct-buff-pill {
  display: inline-flex; align-items: center; gap: 2px;
  padding: 2px 7px; border-radius: 10px;
  font-size: 10px; font-weight: 600; letter-spacing: 0.3px;
}
.ct-buff-pill.buff {
  background: rgba(34,197,94,0.12); color: #22c55e;
  border: 1px solid rgba(34,197,94,0.25);
}
.ct-buff-pill.debuff {
  background: rgba(239,68,68,0.12); color: #ef4444;
  border: 1px solid rgba(239,68,68,0.25);
}

/* ============================================ */
/* Multi-Select Combatant */
/* ============================================ */
.ct-combatant.multi-selected {
  outline: 2px solid var(--gold);
  outline-offset: -2px;
  background: rgba(212,168,36,0.08);
}
.ct-cond-btn.partial {
  outline: 2px dashed currentColor;
  outline-offset: -2px;
  opacity: 0.6;
}

/* ============================================ */
/* Combatant Image */
/* ============================================ */
.ct-combatant-img {
  width: 32px; height: 32px; border-radius: 50%;
  object-fit: cover; flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.15);
}
.ct-image-section {
  margin-bottom: 8px;
}
.ct-image-preview {
  display: flex; align-items: center; justify-content: center;
  min-height: 36px;
}
.ct-detail-img {
  width: 64px; height: 64px; border-radius: 8px;
  object-fit: cover; border: 2px solid rgba(255,255,255,0.15);
}
.ct-img-remove {
  position: absolute; top: -4px; right: -4px;
  width: 18px; height: 18px; border-radius: 50%;
  background: #f43f5e; color: #fff; border: none;
  font-size: 11px; cursor: pointer; display: flex;
  align-items: center; justify-content: center;
}
.ct-image-preview { position: relative; display: inline-flex; }

/* ============================================ */
/* Calendar Grid Timeline View */
/* ============================================ */
.tl-calgrid-view { padding: 16px; }
.tl-calgrid-header {
  display: flex; align-items: center; justify-content: center;
  gap: 16px; margin-bottom: 16px;
}
.tl-calgrid-title {
  font-size: 16px; font-weight: 600; color: var(--text-primary);
  min-width: 200px; text-align: center;
}
.tl-calgrid-body {
  display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;
}
.tl-calgrid-day-header {
  text-align: center; font-size: 10px; font-weight: 600;
  color: var(--text-muted); padding: 4px 0; text-transform: uppercase;
}
.tl-calgrid-cell {
  min-height: 80px; background: var(--bg-card);
  border: 1px solid var(--border-color); border-radius: var(--radius-sm);
  padding: 4px; font-size: 11px; position: relative;
  transition: var(--transition-fast); cursor: default;
}
.tl-calgrid-cell:hover { border-color: rgba(212,168,36,0.3); }
.tl-calgrid-cell.today { border-color: var(--gold); background: rgba(212,168,36,0.06); }
.tl-calgrid-cell.empty { background: transparent; border-color: transparent; min-height: 0; }
.tl-calgrid-daynum {
  font-size: 11px; font-weight: 600; color: var(--text-secondary);
  margin-bottom: 2px;
}
.tl-calgrid-cell.today .tl-calgrid-daynum { color: var(--gold); }
.tl-calgrid-evt {
  display: block; padding: 2px 4px; border-radius: 3px;
  font-size: 10px; color: #fff; margin-bottom: 1px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  cursor: pointer; transition: var(--transition-fast);
}
.tl-calgrid-evt:hover { filter: brightness(1.2); }

/* ============================================ */
/* Global Search Overlay */
/* ============================================ */
.search-nav-btn {
  color: var(--text-secondary);
  transition: var(--transition-fast);
}
.search-nav-btn:hover { color: var(--gold); }

.search-overlay {
  position: fixed; inset: 0; z-index: 2000;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  display: flex; align-items: flex-start; justify-content: center;
  padding-top: 12vh;
  animation: searchFadeIn 0.15s ease;
}
.search-overlay.hidden { display: none; }
@keyframes searchFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.search-box {
  width: 580px; max-width: 90vw;
  background: linear-gradient(180deg, #1e1c1a, #161412);
  border: 1px solid rgba(212,168,36,0.2);
  border-radius: var(--radius-lg);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 0 1px rgba(0,0,0,0.3);
  overflow: hidden;
}
.search-input-row {
  display: flex; align-items: center; gap: 10px;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border-color);
}
.search-icon { flex-shrink: 0; color: var(--text-muted); }
.search-input {
  flex: 1; border: none; background: transparent;
  color: var(--text-primary); font-size: 15px;
  outline: none; font-family: inherit;
}
.search-input::placeholder { color: var(--text-muted); font-size: 13px; }
.search-kbd {
  font-size: 10px; padding: 2px 6px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 4px; color: var(--text-muted);
  font-family: monospace;
}
.search-results {
  max-height: 50vh; overflow-y: auto; padding: 8px;
}
.search-hint {
  padding: 24px 16px; text-align: center;
  color: var(--text-muted); font-size: 13px;
}
.search-no-results {
  padding: 24px 16px; text-align: center;
  color: var(--text-muted); font-size: 13px;
}
.search-group-label {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.8px; color: var(--text-muted);
  padding: 8px 12px 4px; margin-top: 4px;
}
.search-result-item {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px; border-radius: var(--radius-sm);
  cursor: pointer; transition: var(--transition-fast);
}
.search-result-item:hover {
  background: var(--bg-hover);
}
.search-result-icon {
  width: 28px; height: 28px; border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; flex-shrink: 0;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.08);
}
.search-result-info { flex: 1; min-width: 0; }
.search-result-name {
  font-size: 13px; font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.search-result-meta {
  font-size: 11px; color: var(--text-muted);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.search-result-tags {
  display: flex; gap: 3px; flex-shrink: 0;
}
.search-result-tag {
  font-size: 9px; padding: 1px 5px;
  background: rgba(212,168,36,0.12);
  color: var(--gold); border-radius: 8px;
  border: 1px solid rgba(212,168,36,0.2);
}
.search-match { color: var(--gold); font-weight: 600; }

/* ============================================ */
/* Wiki-style [[links]] */
/* ============================================ */
.wiki-link {
  color: var(--gold); cursor: pointer;
  text-decoration: underline; text-decoration-style: dotted;
  text-underline-offset: 2px;
  transition: var(--transition-fast);
}
.wiki-link:hover { color: #e8c84a; text-decoration-style: solid; }

/* ============================================ */
/* Ability/Spell Card */
/* ============================================ */
.ability-card-content { padding: 4px 0; }
.ability-type-badge {
  display: inline-block; font-size: 9px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.5px;
  padding: 2px 6px; border-radius: 3px;
  background: rgba(168,152,128,0.12); color: var(--text-muted);
  margin-bottom: 4px;
}
.ability-desc { font-size: 11px; color: var(--text-secondary); margin: 4px 0; line-height: 1.4; }
.ability-uses {
  display: flex; align-items: center; gap: 4px; margin-top: 6px;
}
.ability-tick {
  width: 18px; height: 18px; border-radius: 3px;
  border: 2px solid rgba(168,152,128,0.3);
  cursor: pointer; transition: var(--transition-fast);
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; color: transparent;
}
.ability-tick.filled {
  background: var(--gold); border-color: var(--gold);
  color: #000;
}
.ability-tick:hover { border-color: var(--gold); }
.ability-uses-label { font-size: 10px; color: var(--text-muted); margin-left: 4px; }
.ability-counter {
  display: flex; align-items: center; gap: 6px; margin-top: 6px;
}
.ability-counter-btn {
  width: 22px; height: 22px; border-radius: 4px;
  border: 1px solid var(--border-color); background: var(--bg-lighter);
  color: var(--text-primary); font-size: 14px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: var(--transition-fast);
}
.ability-counter-btn:hover { border-color: var(--gold); }
.ability-counter-val {
  font-size: 16px; font-weight: 700; color: var(--gold); min-width: 28px; text-align: center;
}

/* ============================================
   Pin Icon Color Picker
   ============================================ */
.pin-icon-color-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}
.pin-icon-color-picker {
  width: 36px;
  height: 36px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: transparent;
  cursor: pointer;
  padding: 2px;
}
.pin-icon-color-label {
  font-size: 12px;
  color: var(--text-muted);
  font-family: monospace;
}

/* ============================================
   Mind Map View
   ============================================ */
.mindmap-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  background: var(--bg-primary);
  background-image:
    radial-gradient(circle at 20% 30%, rgba(78,205,196,0.03) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(139,92,246,0.03) 0%, transparent 50%);
  overflow: hidden;
}
.mindmap-toolbar {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 10;
  display: flex;
  gap: 6px;
}
.mindmap-toolbar .btn {
  backdrop-filter: blur(8px);
  background: rgba(30,30,40,0.8);
  border: 1px solid var(--border-color);
}
.mindmap-toolbar .btn:hover {
  background: rgba(50,50,65,0.9);
  border-color: var(--gold);
}
.mindmap-canvas {
  width: 100%;
  height: 100%;
  min-height: 400px;
  cursor: grab;
}
.mindmap-canvas:active {
  cursor: grabbing;
}

/* Hex node animations */
.mm-node {
  transition: opacity 0.15s;
}
.mm-node:hover path:first-of-type,
.mm-node:hover path:nth-of-type(2) {
  fill-opacity: 0.38 !important;
  stroke-width: 2.2 !important;
}
.mm-node.selected path {
  filter: drop-shadow(0 0 12px rgba(255,255,255,0.15));
}

/* Glow pulse on selected hex */
@keyframes mmGlowPulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}
.mm-glow {
  animation: mmGlowPulse 2s ease-in-out infinite;
}

/* Mind Map Details Panel */
.mindmap-details {
  padding: 16px;
}
.mm-items-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 300px;
  overflow-y: auto;
}
.mm-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  transition: background 0.15s, transform 0.1s;
}
.mm-item:hover {
  background: var(--bg-card);
  transform: translateX(2px);
}
.mm-item-icon {
  font-size: 14px;
  flex-shrink: 0;
}
.mm-item-name {
  flex: 1;
  font-size: 12px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.mm-item-type {
  font-size: 10px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Physics Sliders */
.mm-slider-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}
.mm-slider-label {
  font-size: 11px;
  color: var(--text-muted);
  min-width: 72px;
  flex-shrink: 0;
}
.mm-slider {
  flex: 1;
  height: 14px;
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  outline: none;
  cursor: pointer;
  margin: 0;
}
.mm-slider::-webkit-slider-runnable-track {
  height: 4px;
  border-radius: 2px;
  background: var(--bg-lighter);
}
.mm-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--gold);
  border: 2px solid var(--bg-primary);
  cursor: pointer;
  transition: transform 0.1s;
  margin-top: -5px;
}
.mm-slider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
}
.mm-slider::-moz-range-track {
  height: 4px;
  border-radius: 2px;
  background: var(--bg-lighter);
}
.mm-slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--gold);
  border: 2px solid var(--bg-primary);
  cursor: pointer;
}

/* Mind Map Settings panel (always visible in mindmap view) */
.mindmap-settings {
  padding: 16px;
}

/* Lock body during mind map drag to prevent text selection */
body.mm-dragging {
  user-select: none !important;
  -webkit-user-select: none !important;
  cursor: grabbing !important;
}
body.mm-dragging .sidebar,
body.mm-dragging .details-panel {
  pointer-events: none;
}
body.mm-dragging .mindmap-canvas {
  cursor: grabbing !important;
}

/* ============================================
   Map Regions
   ============================================ */
.regions-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  overflow: visible;
}
.regions-layer .region-group {
  pointer-events: all;
}
.region-draw-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3;
  overflow: visible;
  z-index: 3;
}

/* Region Details Panel */
.region-details {
  padding: 16px;
}
.region-points-list {
  display: flex;
  flex-direction: column;
  gap: 3px;
  max-height: 200px;
  overflow-y: auto;
}
.region-point-row {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 6px;
  background: var(--bg-lighter);
  border-radius: var(--radius-sm);
  font-size: 11px;
}
.region-point-label {
  color: var(--gold);
  font-weight: 700;
  min-width: 24px;
}
.region-point-coords {
  flex: 1;
  color: var(--text-muted);
  font-family: monospace;
  font-size: 10px;
}
.region-point-curve-btn {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  color: var(--text-muted);
  border-radius: var(--radius-sm);
  padding: 2px 6px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition-fast);
}
.region-point-curve-btn:hover {
  border-color: var(--gold);
  color: var(--text-primary);
}
.region-point-curve-btn.active {
  background: var(--gold);
  color: var(--bg-primary);
  border-color: var(--gold);
}
.region-point-del-btn {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 14px;
  padding: 0 4px;
  transition: color 0.15s;
}
.region-point-del-btn:hover {
  color: var(--danger);
}

/* ============================================
   Swatch Color Picker
   ============================================ */
.swatch-picker {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  align-items: center;
}
.swatch-btn {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  border: 2px solid transparent;
  cursor: pointer;
  transition: transform 0.1s, border-color 0.15s;
  padding: 0;
  flex-shrink: 0;
}
.swatch-btn:hover {
  transform: scale(1.15);
}
.swatch-btn.active {
  border-color: #fff;
  box-shadow: 0 0 0 2px var(--bg-dark), 0 0 6px rgba(255,255,255,0.2);
}
.swatch-custom-wrap {
  position: relative;
  width: 22px;
  height: 22px;
  flex-shrink: 0;
}
.swatch-custom-input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.swatch-custom-display {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  border: 2px dashed var(--border-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text-muted);
  pointer-events: none;
  transition: border-color 0.15s;
  background: var(--bg-dark);
}
.swatch-custom-wrap:hover .swatch-custom-display {
  border-color: var(--text-secondary);
}
.swatch-custom-wrap.active .swatch-custom-display {
  border-style: solid;
  border-color: #fff;
  box-shadow: 0 0 0 2px var(--bg-dark), 0 0 6px rgba(255,255,255,0.2);
}

/* Region Draw Handles (HTML overlays - always circular) */
.region-draw-handle {
  position: absolute;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #4ecdc4;
  border: 2px solid #fff;
  transform: translate(-50%, -50%);
  transform-origin: center center;
  cursor: pointer;
  z-index: 5;
  pointer-events: all;
  box-shadow: 0 0 4px rgba(0,0,0,0.4);
  transition: box-shadow 0.1s;
}
.region-draw-handle:hover {
  box-shadow: 0 0 8px rgba(78,205,196,0.8), 0 0 4px rgba(0,0,0,0.4);
}
.region-draw-handle.first {
  width: 16px;
  height: 16px;
  background: #f59e0b;
  border: 2px solid #fff;
  box-shadow: 0 0 8px rgba(245,158,11,0.5);
}
.region-draw-handle.first:hover {
  box-shadow: 0 0 14px rgba(245,158,11,0.9), 0 0 6px rgba(245,158,11,0.5);
}

/* Region Edit Handles (shown on selected region) */
.region-edit-handle {
  position: absolute;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid #4ecdc4;
  transform: translate(-50%, -50%);
  transform-origin: center center;
  cursor: grab;
  z-index: 5;
  pointer-events: all;
  box-shadow: 0 0 3px rgba(0,0,0,0.4);
  transition: background 0.15s, border-color 0.15s;
}
.region-edit-handle:hover {
  background: #4ecdc4;
  border-color: #fff;
}
.region-edit-handle:active {
  cursor: grabbing;
}
.region-edit-handle.curved {
  background: #f59e0b;
  border-color: #fff;
  border-radius: 2px;
}
.region-edit-handle.curved:hover {
  background: #fbbf24;
}
.region-edit-handle.region-edge-add {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(30,30,40,0.7);
  border: 1.5px dashed rgba(78,205,196,0.6);
  color: #4ecdc4;
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  opacity: 0.35;
  transition: opacity 0.2s, background 0.15s;
  cursor: crosshair;
}
.region-edit-handle.region-edge-add:hover {
  opacity: 1;
  background: rgba(78,205,196,0.3);
  border-color: #4ecdc4;
}
.region-edit-handle.midpoint {
  width: 16px;
  height: 16px;
  background: rgba(30,30,40,0.7);
  border: 1.5px dashed #4ecdc4;
  color: #4ecdc4;
  font-size: 12px;
  font-weight: 700;
  line-height: 14px;
  text-align: center;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.15s, background 0.15s;
}
.region-edit-handle.midpoint:hover {
  opacity: 1;
  background: #4ecdc4;
  border-style: solid;
  color: #fff;
}

/* ============================================
   Multiview DM Screen
   ============================================ */
.multiview-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0 !important;
  border-radius: var(--radius-md);
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-muted);
  transition: var(--transition-fast);
}
.multiview-btn:hover {
  background: var(--bg-light);
  border-color: var(--border-color);
  color: var(--gold);
}
.multiview-btn svg { stroke: currentColor; }

.multiview-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  background: var(--bg-dark);
  display: flex;
  flex-direction: column;
}
.multiview-overlay.hidden { display: none; }

.multiview-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 6px 12px;
  background: var(--bg-medium);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}
.multiview-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 0.3px;
}
.multiview-title svg { stroke: var(--gold); }
.multiview-layout-btns {
  display: flex;
  gap: 3px;
  margin-left: auto;
}
.mv-layout-btn {
  width: 30px;
  height: 26px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-dark);
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
  padding: 0;
}
.mv-layout-btn:hover { border-color: var(--text-secondary); color: var(--text-primary); }
.mv-layout-btn.active {
  border-color: var(--gold);
  color: var(--gold);
  background: rgba(212,168,36,0.06);
}
.mv-layout-btn svg { stroke: currentColor; width: 14px; height: 14px; }
.mv-close-btn {
  width: 30px;
  height: 26px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-dark);
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
  padding: 0;
  margin-left: 4px;
}
.mv-close-btn:hover { border-color: var(--danger); color: var(--danger); }
.mv-close-btn svg { stroke: currentColor; }

.multiview-grid {
  flex: 1;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 1px;
  overflow: hidden;
  min-height: 0;
  background: var(--border-color);
}
.multiview-grid[data-layout="2col"] {
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr;
}
.multiview-grid[data-layout="2col"] .mv-panel:nth-child(n+3) { display: none; }
.multiview-grid[data-layout="3col"] {
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 1fr;
}
.multiview-grid[data-layout="3col"] .mv-panel:nth-child(4) { display: none; }
.multiview-grid[data-layout="1plus2"] {
  grid-template-columns: 2fr 1fr;
  grid-template-rows: 1fr 1fr;
}
.multiview-grid[data-layout="1plus2"] .mv-panel:first-child {
  grid-row: 1 / 3;
}
.multiview-grid[data-layout="1plus2"] .mv-panel:nth-child(4) { display: none; }

.mv-panel {
  display: flex;
  flex-direction: column;
  background: var(--bg-dark);
  overflow: hidden;
  min-height: 0;
}
.mv-panel-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 6px;
  background: var(--bg-medium);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}
.mv-panel-select {
  flex: 1;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  padding: 3px 6px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
}
.mv-panel-select:focus { border-color: var(--gold); outline: none; }

.mv-panel-content {
  flex: 1;
  display: flex;
  min-height: 0;
  overflow: hidden;
}
.mv-panel-nav {
  width: 140px;
  min-width: 140px;
  background: var(--bg-medium);
  border-right: 1px solid var(--border-color);
  overflow-y: auto;
  flex-shrink: 0;
  padding: 4px 0;
}
.mv-panel-nav.hidden { display: none; }
.mv-panel-nav .mv-nav-tabs {
  display: flex;
  border-bottom: 1px solid var(--border-color);
  padding: 0 4px;
  margin-bottom: 4px;
}
.mv-panel-nav .mv-nav-tab {
  flex: 1;
  padding: 4px 2px;
  font-size: 10px;
  font-weight: 600;
  text-align: center;
  color: var(--text-muted);
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: var(--transition-fast);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.mv-panel-nav .mv-nav-tab:hover { color: var(--text-primary); }
.mv-panel-nav .mv-nav-tab.active {
  color: var(--gold);
  border-bottom-color: var(--gold);
}
.mv-nav-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  cursor: pointer;
  color: var(--text-secondary);
  font-size: 11px;
  transition: var(--transition-fast);
  border-left: 2px solid transparent;
}
.mv-nav-item:hover {
  background: var(--bg-light);
  color: var(--text-primary);
}
.mv-nav-item.active {
  background: rgba(212,168,36,0.06);
  color: var(--gold);
  border-left-color: var(--gold);
}
.mv-nav-item .mv-nav-icon {
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  opacity: 0.6;
}
.mv-nav-item .mv-nav-label {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.mv-panel-body {
  flex: 1;
  overflow: auto;
  position: relative;
  min-height: 0;
}
.mv-panel-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-muted);
  font-size: 12px;
  font-style: italic;
}


/* DM Screen - Embedded View Styles */
.mv-embedded {
  position: absolute !important;
  inset: 0;
  display: flex !important;
  overflow: auto;
}
/* Hide editing controls inside DM screen panels */
.mv-embedded .canvas-tools,
.mv-embedded .board-toolbar,
.mv-embedded .write-toolbar,
.mv-embedded .connection-mode-indicator,
.mv-embedded .canvas-empty-state {
  display: none !important;
}
/* Make write view read-only appearance */
.mv-embedded .write-chapter-label-input,
.mv-embedded .write-chapter-title {
  pointer-events: none;
}
.mv-embedded .write-editor {
  pointer-events: none;
  user-select: text;
}
.mv-embedded .write-stats { display: none; }

/* ============================================
   Soundscape
   ============================================ */
.soundboard-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  flex: 1;
  overflow: hidden;
  background: var(--bg-dark);
}
.sb-master {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 8px 14px;
  background: var(--bg-medium);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}
.sb-master-left {
  display: flex;
  align-items: center;
  gap: 8px;
}
.sb-master-right {
  display: flex;
  align-items: center;
  gap: 4px;
}
.sb-master-btn {
  width: 30px;
  height: 28px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-dark);
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
  padding: 0;
  font-size: 10px;
  font-weight: 600;
}
.sb-master-btn:hover { border-color: var(--text-secondary); color: var(--text-primary); }
.sb-master-btn.sb-play:hover { color: #22c55e; border-color: #22c55e; }
.sb-master-btn.sb-stop:hover { color: var(--danger); border-color: var(--danger); }
.sb-master-btn.sb-del:hover { color: var(--danger); border-color: var(--danger); }
.sb-master-btn.active { border-color: #22c55e; color: #22c55e; background: rgba(34,197,94,0.06); }
.sb-master-vol {
  display: flex;
  align-items: center;
  gap: 6px;
}
.sb-master-vol-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.sb-master-vol input[type="range"] {
  width: 80px;
  height: 4px;
  accent-color: var(--gold);
}
.sb-master-vol-val {
  font-size: 10px;
  color: var(--text-secondary);
  width: 28px;
}
.sb-master-right select {
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  padding: 4px 6px;
  font-size: 11px;
  cursor: pointer;
  max-width: 160px;
}
.sb-categories {
  display: flex;
  gap: 2px;
  padding: 6px 14px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-medium);
  flex-shrink: 0;
}
.sb-cat-btn {
  padding: 4px 12px;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  background: none;
  color: var(--text-muted);
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-fast);
}
.sb-cat-btn:hover { color: var(--text-primary); background: var(--bg-light); }
.sb-cat-btn.active {
  color: var(--gold);
  background: rgba(212,168,36,0.06);
  border-color: rgba(212,168,36,0.2);
}
.sb-channels {
  flex: 1;
  overflow-y: auto;
  padding: 14px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 8px;
  align-content: flex-start;
}
.sb-tile {
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: var(--transition-fast);
  cursor: default;
}
.sb-tile:hover { border-color: var(--text-muted); }
.sb-tile.playing {
  border-color: rgba(34,197,94,0.4);
  background: rgba(34,197,94,0.03);
}
.sb-tile-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}
.sb-tile-name {
  font-size: 12px;
  font-weight: 700;
  color: var(--text-primary);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.sb-tile-cat {
  font-size: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  font-weight: 600;
}
.sb-tile-controls {
  display: flex;
  align-items: center;
  gap: 6px;
}
.sb-tile-play {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 1px solid var(--border-color);
  background: var(--bg-dark);
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
  padding: 0;
  flex-shrink: 0;
}
.sb-tile-play:hover { border-color: var(--text-secondary); color: var(--text-primary); }
.sb-tile.playing .sb-tile-play {
  border-color: #22c55e;
  color: #22c55e;
  background: rgba(34,197,94,0.08);
}
.sb-tile-vol {
  flex: 1;
  height: 4px;
  accent-color: var(--accent);
  min-width: 0;
}
.sb-tile.playing .sb-tile-vol { accent-color: #22c55e; }
.sb-tile-vol-val {
  font-size: 9px;
  color: var(--text-muted);
  width: 24px;
  text-align: right;
  flex-shrink: 0;
}
.sb-tile-loop {
  width: 22px;
  height: 22px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
  background: none;
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  font-size: 9px;
  transition: var(--transition-fast);
  flex-shrink: 0;
}
.sb-tile-loop:hover { border-color: var(--text-secondary); }
.sb-tile-loop.active {
  border-color: var(--accent);
  color: var(--accent);
  background: rgba(78,205,196,0.06);
}


/* Soundboard full-width (no sidebar/details) */
.main-content.sb-active .sidebar,
.main-content.sb-active .details-panel {
  display: none;
}
.sb-sep {
  width: 1px;
  height: 18px;
  background: var(--border-color);
  flex-shrink: 0;
}
.sb-tile-type {
  font-size: 7px;
  text-transform: uppercase;
  letter-spacing: 0.4px;
  padding: 1px 5px;
  border-radius: 3px;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--border-color);
  color: var(--text-muted);
  flex-shrink: 0;
}
.sb-tile.custom-tile { border-left: 2px solid var(--accent); }
.sb-tile.yt-tile { border-left: 2px solid #ff4444; }
.sb-tile-remove {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: none;
  background: none;
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  font-size: 12px;
  opacity: 0;
  transition: var(--transition-fast);
}
.sb-tile:hover .sb-tile-remove { opacity: 1; }
.sb-tile-remove:hover { color: var(--danger); }
/* YouTube popup */
.sb-yt-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 20px;
  z-index: 10001;
  width: 400px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.5);
}
.sb-yt-popup h3 {
  margin: 0 0 12px;
  font-size: 14px;
  color: var(--text-primary);
}
.sb-yt-popup input {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-dark);
  color: var(--text-primary);
  font-size: 12px;
  margin-bottom: 8px;
  box-sizing: border-box;
}
.sb-yt-popup .sb-yt-actions {
  display: flex;
  gap: 6px;
  justify-content: flex-end;
}
.sb-yt-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 10000;
}
.sb-yt-hidden-player {
  position: absolute;
  width: 1px;
  height: 1px;
  overflow: hidden;
  opacity: 0;
  pointer-events: none;
}
/* MultiView connected indicator */
#sbMvConnectBtn.mv-connected { color: var(--gold); border-color: var(--gold); }
#sbMvConnectBtn.mv-connected::after { content: ''; width: 5px; height: 5px; background: #22c55e; border-radius: 50%; position: absolute; top: 2px; right: 2px; }
#sbMvConnectBtn { position: relative; }
.sb-mv-playlist { margin-left: 8px; }

/*  Browse Button  */
.sb-browse-btn {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px !important;
  font-size: 11px;
  background: rgba(212,168,36,0.08);
  border-color: var(--gold);
  color: var(--gold);
}
.sb-browse-btn:hover {
  background: rgba(212,168,36,0.18);
}

/*  Category Picker  */
.sb-cat-picker {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 12px;
}
.sb-cat-pick-btn {
  padding: 5px 10px;
  font-size: 11px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition-fast);
}
.sb-cat-pick-btn:hover {
  color: var(--gold);
  border-color: var(--gold);
  background: rgba(212,168,36,0.08);
}
.sb-cat-pick-btn.selected {
  color: var(--gold);
  border-color: var(--gold);
  background: rgba(212,168,36,0.15);
  font-weight: 600;
}

/*  Freesound Browser  */
.sb-fs-browser {
  width: 580px !important;
  max-height: 85vh !important;
  display: flex !important;
  flex-direction: column !important;
  padding: 0 !important;
}
.sb-fs-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px 8px;
  flex-shrink: 0;
}
.sb-fs-header h3 { margin: 0; }
.sb-fs-close {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 20px;
  cursor: pointer;
  padding: 4px;
  line-height: 1;
}
.sb-fs-close:hover { color: var(--text-primary); }
.sb-fs-key-row {
  padding: 0 20px 10px;
  flex-shrink: 0;
}
.sb-fs-key-row.sb-fs-key-saved {
  display: none;
}
.sb-fs-search {
  display: flex;
  gap: 6px;
  padding: 0 20px 8px;
  flex-shrink: 0;
}
.sb-fs-search input {
  flex: 1;
  padding: 7px 10px;
  font-size: 13px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
}
.sb-fs-search input:focus {
  border-color: var(--gold);
  outline: none;
}
.sb-fs-filters {
  display: flex;
  gap: 6px;
  padding: 0 20px 10px;
  flex-shrink: 0;
}
.sb-fs-filters select {
  padding: 4px 8px;
  font-size: 11px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
}
.sb-fs-results {
  flex: 1;
  overflow-y: auto;
  padding: 0 20px;
  min-height: 200px;
}
.sb-fs-empty, .sb-fs-loading {
  text-align: center;
  color: var(--text-muted);
  padding: 40px 20px;
  font-size: 12px;
}
.sb-fs-loading::after {
  content: '';
  display: inline-block;
  width: 12px;
  height: 12px;
  border: 2px solid var(--border-color);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-left: 8px;
  vertical-align: middle;
}
@keyframes spin { to { transform: rotate(360deg); } }
.sb-fs-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid var(--border-color);
}
.sb-fs-item:last-child { border-bottom: none; }
.sb-fs-item-main {
  flex: 1;
  min-width: 0;
}
.sb-fs-item-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.sb-fs-item-meta {
  display: flex;
  gap: 10px;
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 2px;
}
.sb-fs-item-tags {
  font-size: 10px;
  color: var(--text-muted);
  opacity: 0.7;
  margin-top: 2px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.sb-fs-item-actions {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
}
.sb-fs-preview-btn {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 1px solid var(--border-color);
  background: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
}
.sb-fs-preview-btn:hover, .sb-fs-preview-btn.previewing {
  color: var(--gold);
  border-color: var(--gold);
  background: rgba(212,168,36,0.08);
}
.sb-fs-add-btn {
  padding: 4px 10px;
  font-size: 11px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: none;
  color: var(--text-muted);
  cursor: pointer;
  transition: var(--transition-fast);
  white-space: nowrap;
}
.sb-fs-add-btn:hover {
  color: var(--gold);
  border-color: var(--gold);
  background: rgba(212,168,36,0.08);
}
.sb-fs-paging {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 10px 20px 16px;
  flex-shrink: 0;
}

/* ============================================
   Write: First-Line Indent
   ============================================ */
.write-editor.indent-mode {
  text-indent: 2em;
}
.write-editor.indent-mode p,
.write-editor.indent-mode div:not(.editor-image-wrapper):not(.editor-columns):not(.editor-column):not(.dice-roll-badge) {
  text-indent: 2em;
}
.write-editor.indent-mode h1, .write-editor.indent-mode h2, .write-editor.indent-mode h3,
.write-editor.indent-mode blockquote, .write-editor.indent-mode ul, .write-editor.indent-mode ol {
  text-indent: 0;
}
#indentToggleBtn.active { color: var(--gold); background: rgba(212,168,36,0.15); }

/* ============================================
   Write: Thesaurus Popup
   ============================================ */
.thesaurus-popup {
  position: fixed;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 0;
  z-index: 10001;
  width: 320px;
  max-height: 400px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
  user-select: none;
  -webkit-user-select: none;
}
.thesaurus-header {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}
.thesaurus-header h4 { margin: 0; font-size: 13px; color: var(--text-primary); }
.thesaurus-close {
  width: 20px; height: 20px; border: none; background: none;
  color: var(--text-muted); cursor: pointer; font-size: 14px; padding: 0;
}
.thesaurus-close:hover { color: var(--text-primary); }
.thesaurus-tabs {
  display: flex; border-bottom: 1px solid var(--border-color); flex-shrink: 0;
}
.thesaurus-tab {
  flex: 1; padding: 6px 8px; background: none; border: none; border-bottom: 2px solid transparent;
  color: var(--text-muted); font-size: 11px; cursor: pointer; text-align: center;
}
.thesaurus-tab.active { color: var(--gold); border-bottom-color: var(--gold); }
.thesaurus-body {
  flex: 1; overflow-y: auto; padding: 8px 0; max-height: 280px;
}
.thesaurus-word {
  padding: 4px 14px; font-size: 12px; color: var(--text-secondary); cursor: pointer;
  transition: var(--transition-fast);
}
.thesaurus-word:hover { background: var(--bg-hover); color: var(--gold); }
.thesaurus-loading, .thesaurus-none {
  padding: 20px; text-align: center; color: var(--text-muted); font-size: 12px;
}

/* Thesaurus Preview Panel */
.thesaurus-preview {
  overflow-y: auto;
  max-height: 280px;
  padding: 8px 0;
}
.thes-preview-word {
  padding: 8px 14px 2px;
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
}
.thes-preview-phonetic {
  padding: 0 14px 6px;
  font-size: 11px;
  color: var(--text-muted);
  font-style: italic;
}
.thes-preview-pos {
  padding: 6px 14px 2px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--gold);
}
.thes-preview-def {
  padding: 2px 14px 2px 22px;
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.5;
}
.thes-preview-example {
  padding: 1px 14px 4px 30px;
  font-size: 11px;
  color: var(--text-muted);
  font-style: italic;
}
.thes-preview-actions {
  display: flex;
  gap: 8px;
  padding: 10px 14px;
  border-top: 1px solid var(--border-color);
  margin-top: 8px;
}
.thes-preview-back {
  padding: 5px 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 11px;
}
.thes-preview-back:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}
.thes-preview-use {
  flex: 1;
  padding: 5px 12px;
  border: 1px solid var(--gold);
  border-radius: var(--radius-sm);
  background: var(--gold);
  color: var(--bg-dark);
  cursor: pointer;
  font-size: 11px;
  font-weight: 600;
}
.thes-preview-use:hover {
  background: var(--gold-hover);
}

/* ============================================
   Write: Spell Check Context Menu
   ============================================ */
.spellcheck-popup {
  position: fixed;
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  z-index: 10002;
  min-width: 180px;
  max-width: 240px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.45);
  overflow: hidden;
  user-select: none;
  -webkit-user-select: none;
  animation: fadeIn 0.12s ease;
}
.spellcheck-header {
  padding: 8px 12px 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
}
.spellcheck-word-display {
  padding: 4px 12px 8px;
  font-size: 12px;
  color: var(--text-secondary);
}
.spellcheck-loading {
  padding: 12px;
  text-align: center;
  font-size: 11px;
  color: var(--text-muted);
}
.spellcheck-divider {
  height: 1px;
  background: var(--border-color);
  margin: 2px 0;
}
.spellcheck-item {
  padding: 6px 12px;
  font-size: 13px;
  cursor: pointer;
  transition: var(--transition-fast);
}
.spellcheck-suggestion {
  color: var(--text-primary);
  font-weight: 500;
}
.spellcheck-suggestion:hover {
  background: rgba(212,168,36,0.1);
  color: var(--gold);
}
.spellcheck-action {
  color: var(--text-muted);
  font-size: 11px;
}
.spellcheck-action:hover {
  background: rgba(255,255,255,0.04);
  color: var(--text-primary);
}

/* ============================================
   Write: Export Modal
   ============================================ */
.export-modal-content {
  padding: 16px;
}
.export-options {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.export-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition-fast);
}
.export-option:hover { border-color: var(--gold); }
.export-option-left { display: flex; flex-direction: column; gap: 2px; }
.export-option-name { font-size: 13px; color: var(--text-primary); font-weight: 500; }
.export-option-desc { font-size: 10px; color: var(--text-muted); }
.export-option-ext {
  font-size: 10px; padding: 2px 6px; background: rgba(212,168,36,0.15);
  color: var(--gold); border-radius: 3px; font-weight: 600;
}
.export-scope {
  margin-bottom: 12px;
}
.export-scope label {
  display: flex; align-items: center; gap: 8px; padding: 4px 0;
  font-size: 12px; color: var(--text-secondary); cursor: pointer;
}
.export-scope input[type="radio"] { accent-color: var(--gold); }

/* ============================================
   Soundscape: Sidebar Layout
   ============================================ */
.sb-layout {
  display: flex;
  height: 100%;
  overflow: hidden;
}
.sb-sidebar {
  width: 200px;
  min-width: 200px;
  background: var(--bg-dark);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}
.sb-sidebar-section { border-bottom: 1px solid var(--border-color); }
.sb-sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
}
.sb-sidebar-add {
  width: 20px; height: 20px; border: 1px solid var(--border-color); border-radius: 4px;
  background: none; color: var(--text-muted); cursor: pointer; font-size: 14px;
  display: flex; align-items: center; justify-content: center; padding: 0;
}
.sb-sidebar-add:hover { border-color: var(--gold); color: var(--gold); }
.sb-sidebar-list { padding: 4px 0; }
.sb-sidebar-empty { padding: 10px; font-size: 10px; color: var(--text-muted); text-align: center; }
.sb-sidebar-item {
  display: flex; align-items: center; gap: 6px; padding: 5px 10px;
  font-size: 11px; color: var(--text-secondary); cursor: pointer;
  transition: var(--transition-fast); position: relative;
}
.sb-sidebar-item:hover { background: var(--bg-hover); color: var(--text-primary); }
.sb-sidebar-item.active { color: var(--gold); background: rgba(212,168,36,0.08); border-left: 2px solid var(--gold); }
.sb-sidebar-item .sb-si-count {
  font-size: 9px; color: var(--text-muted); margin-left: auto; min-width: 16px; text-align: right;
}
.sb-sidebar-item .sb-si-actions {
  display: flex; gap: 2px; opacity: 0; transition: var(--transition-fast); position: absolute; right: 4px;
}
.sb-sidebar-item:hover .sb-si-actions { opacity: 1; }
.sb-si-btn {
  width: 16px; height: 16px; border: none; background: none; color: var(--text-muted);
  cursor: pointer; font-size: 10px; padding: 0; border-radius: 3px;
}
.sb-si-btn:hover { color: var(--danger); background: rgba(255,0,0,0.1); }
.sb-si-btn.sb-si-play:hover { color: var(--gold); background: rgba(212,168,36,0.1); }
.sb-main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.sb-main .sb-channels { flex: 1; overflow-y: auto; }

/* ============================================
   Site Dialog (replaces browser prompt/confirm)
   ============================================ */
.site-dialog-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 10100;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.15s ease;
}
.site-dialog {
  background: var(--bg-medium);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  width: 360px;
  box-shadow: 0 16px 48px rgba(0,0,0,0.5);
  animation: slideUp 0.2s ease;
  overflow: hidden;
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
.site-dialog-title {
  padding: 16px 18px 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}
.site-dialog-actions {
  padding: 8px 18px 16px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
.site-dialog .sb-cat-picker {
  padding: 0 18px 8px;
}
.site-dialog .site-dialog-input {
  margin-left: 18px;
  margin-right: 18px;
  width: calc(100% - 36px);
}
.site-dialog-header {
  padding: 14px 18px 0;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}
.site-dialog-body {
  padding: 12px 18px;
}
.site-dialog-body p {
  margin: 0;
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.5;
}
.site-dialog-input {
  width: 100%;
  padding: 8px 10px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 13px;
  outline: none;
  transition: var(--transition-fast);
  box-sizing: border-box;
}
.site-dialog-input:focus {
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(212,168,36,0.15);
}
.site-dialog-footer {
  padding: 10px 18px 14px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
.site-dialog-btn {
  padding: 6px 16px;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--border-color);
  transition: var(--transition-fast);
}
.site-dialog-btn.cancel {
  background: none;
  color: var(--text-muted);
}
.site-dialog-btn.cancel:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}
.site-dialog-btn.confirm {
  background: var(--gold);
  color: var(--bg-dark);
  border-color: var(--gold);
}
.site-dialog-btn.confirm:hover {
  background: var(--gold-hover);
}
.site-dialog-btn.danger {
  background: var(--danger);
  color: #fff;
  border-color: var(--danger);
}
.site-dialog-btn.danger:hover {
  opacity: 0.85;
}
